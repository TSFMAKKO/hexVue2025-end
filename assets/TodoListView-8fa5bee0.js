import{i as U,a as E,o as d,c as v,f as W,v as j,j as D,b as o,k as q,l as B,e as h,d as g,u as I,r as _,p as A,m as w,n as R,t as C,q as T,F as H,s as J,g as L}from"./index-8302a891.js";import{_ as G,a as f}from"./isLoading-72be3c1c.js";import{S as m}from"./sweetalert2.esm.all-263d9c0b.js";const Q={class:"inputBox"},X={key:1,href:"#"},Y={__name:"TodoForm",emits:{createData:Function},setup(b,{emit:$}){const i=$,l=U("createText"),a=()=>{l.value.trim()!==""&&(i("createData"),l.value="")};return(y,k)=>{const c=E("font-awesome-icon");return d(),v("div",Q,[W(o("input",{type:"text","onUpdate:modelValue":k[0]||(k[0]=x=>q(l)?l.value=x:null),onKeypress:B(a,["enter"]),placeholder:"請輸入待辦事項"},null,544),[[j,D(l)]]),D(l).trim()!==""?(d(),v("a",{key:0,href:"#",onClick:h(a,["prevent"])},[g(c,{icon:"plus"})])):(d(),v("a",X,[g(c,{icon:"ban"})]))])}}};const Z={id:"todoListPage",class:"bg-half"},ee={class:"todo_sm"},te={href:"#"},oe={class:"conatiner todoListPage vhContainer"},se={class:"todoList_Content"},ne={class:"todoList_list"},ae={class:"todoList_tab"},le={class:"todoList_items"},ie={class:"todoList_item"},ce={class:"todoList_label"},re=["checked","onClick"],ue={key:0,class:"form-control"},de=["value","onBlur","onKeyup"],ve=["onClick"],fe=["onClick"],pe={key:0},he={class:"todoList_statistics"},p="https://todolist-api.hexschool.io",ke={__name:"TodoListView",setup(b){const $=I(),i=_(""),l=_("");A("isLoading",l);const a=_([]);w(()=>a.value.length>0);const y=_(null),k=_(""),c=_("all"),x=w(()=>a.value.filter(e=>e.status===!1).length),z=w(()=>{if(c.value==="all")return a.value;if(c.value==="uncompleted")return a.value.filter(e=>e.status===!1);if(c.value==="completed")return a.value.filter(e=>e.status===!0)}),V=async()=>{console.log("logout"),l.value=!0;try{let e=document.cookie.split(";").find(n=>n.trim().startsWith("token="));e=e.split("=")[1],console.log("token exists:",e);const t=await f.post(p+"/users/sign_out",{},{headers:{Authorization:`${e}`}});console.log("res.data:",t.data),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",l.value=!1,i.value="",y.value=null,m.fire({title:"成功登出",icon:"success",confirmButtonText:"確定"})}catch(e){console.log("登出失敗",e),m.fire({title:"登出失敗",text:`${e.data.message}！`,icon:"error",confirmButtonText:"確定"}),l.value=!1}},N=async()=>{console.log("checkOnline"),l.value=!0;try{const e=document.cookie.split(";");console.log("cookies:",e),i.value=e.find(n=>n.trim().startsWith("token=")).split("=")[1],i.value&&console.log("token exists:",i.value);const t=await f.get(p+"/users/checkout",{headers:{Authorization:`${i.value}`}});console.log(t.data),y.value=t.data,O()}catch{m.fire({title:"不再線上 即將踢人",icon:"error",confirmButtonText:"確定"}).then(t=>{$.push("/login"),l.value=!1})}};R(()=>{console.log("TodoListView onMounted"),l.value=!1,N()});const O=async()=>{console.log("token:",i.value),l.value=!0;const e=await f.get(p+"/todos/",{headers:{Authorization:`${i.value}`}});console.log(e.data),e.data.data.forEach((t,n)=>{setTimeout(()=>{console.log("todo:",t),a.value.push(t),n===e.data.data.length-1&&(l.value=!1)},400*(n+1))}),e.data.data.length===0&&(l.value=!1)},F=async(e,t)=>{console.log("id:",e);const n=`${p}/todos/${e}/toggle`;console.log(n);try{const u=await f.patch(n,{},{headers:{Authorization:`${i.value}`}}),s=a.value.find(r=>r.id===e);s.status=!s.status,console.log(u.data)}catch{}console.log(a.value)},K=async(e,t)=>{console.log("updateText","id:",e);const n=t.target.value,u=`${p}/todos/${e}`;console.log(u);try{const s=await f.put(u,{content:n},{headers:{Authorization:`${i.value}`}});s.status&&a.value.map(r=>(r.id===e&&(r.content=n,r.isEdit=!1),r)),t.target.value=n,console.log(s.data)}catch{}console.log(a.value)},M=async()=>{const e=`${p}/todos/`;console.log(e);const t=await f.post(e,{content:k.value},{headers:{Authorization:`${i.value}`}});console.log(t),t.status&&a.value.push(t.data.newTodo)},S=async e=>{console.log("id:",e);const t=a.value.find(n=>n.id===e);return m.fire({title:"確定要刪除這筆資料嗎？",text:`${t.content} 會被刪除`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(n=>{if(n.isConfirmed)return m.fire("刪除了！","資料已經被刪除。","success"),!0;if(n.isDismissed)return m.fire("取消刪除","資料未被刪除","info"),!1})},P=async(e,t)=>{if(!await S(e))return;console.log("id:",e);const n=`${p}/todos/${e}`;console.log(n);try{const u=await f.delete(n,{headers:{Authorization:`${i.value}`}});a.value=a.value.filter(s=>{if(s.id!=e)return s}),console.log(u.data)}catch{}console.log(a.value)};return A("createText",k),(e,t)=>{var u;const n=E("font-awesome-icon");return d(),v("div",Z,[g(G),o("nav",null,[t[3]||(t[3]=o("h1",null,[o("a",{href:"#"},"ONLINE TODO LIST")],-1)),o("ul",null,[o("li",ee,[o("a",te,[o("span",null,C((u=y.value)==null?void 0:u.nickname)+"的代辦",1)])]),o("li",null,[o("a",{onClick:V,href:"#loginPage"},"登出")])])]),o("div",oe,[o("div",se,[g(Y,{onCreateData:M}),o("div",ne,[o("ul",ae,[o("li",null,[o("a",{href:"#",onClick:t[0]||(t[0]=h(s=>c.value="all",["prevent"])),class:T({active:c.value==="all"})},"全部",2)]),o("li",null,[o("a",{href:"#",onClick:t[1]||(t[1]=h(s=>c.value="uncompleted",["prevent"])),class:T({active:c.value==="uncompleted"})},"待完成",2)]),o("li",null,[o("a",{href:"#",onClick:t[2]||(t[2]=h(s=>c.value="completed",["prevent"])),class:T({active:c.value==="completed"})},"已完成",2)])]),o("div",le,[o("ul",ie,[(d(!0),v(H,null,J(z.value,s=>(d(),v("li",{key:s.id},[o("label",ce,[o("input",{class:"todoList_input",type:"checkbox",checked:s.status,onClick:h(r=>F(s.id),["prevent"])},null,8,re),s.isEdit?L("",!0):(d(),v("span",ue,C(s.content),1)),s.isEdit?(d(),v("input",{key:1,class:"form-control",type:"text",value:s.content,onBlur:r=>s.isEdit=!1,onKeyup:[B(r=>K(s.id,r),["enter"]),B(r=>s.isEdit=!1,["esc"])]},null,40,de)):L("",!0)]),c.value==="completed"?(d(),v("a",{key:0,href:"#",onClick:h(r=>P(s.id),["prevent"])},[g(n,{icon:"times"})],8,ve)):(d(),v("a",{key:1,href:"#",onClick:h(r=>s.isEdit=!0,["prevent"])},[g(n,{icon:"pen-to-square"})],8,fe))]))),128)),a.value.length===0?(d(),v("li",pe,"目前無代辦事項 ")):L("",!0)]),o("div",he,[o("p",null,C(x.value)+" 個未完成項目",1)])])])])])])}}};export{ke as default};
