import{_ as I,a as _}from"./isLoading-8f178ba8.js";import{i as D,a as b,o as v,c as f,f as K,v as P,j as $,b as s,k as j,l as H,e as T,d as y,t as E,g as A,n as B,F as q,m as R,q as J,u as G,r as w,p as L,s as V,x as Q}from"./index-f47085d2.js";import{S as C}from"./sweetalert2.esm.all-263d9c0b.js";const X={class:"inputBox"},Y={key:1,href:"#"},Z={__name:"TodoForm",emits:{createData:Function},setup(c,{emit:k}){const n=k,o=D("createText"),i=()=>{o.value.trim()!==""&&(n("createData"),o.value="")};return(h,g)=>{const r=b("font-awesome-icon");return v(),f("div",X,[K(s("input",{type:"text","onUpdate:modelValue":g[0]||(g[0]=t=>j(o)?o.value=t:null),onKeypress:H(i,["enter"]),placeholder:"請輸入待辦事項"},null,544),[[P,$(o)]]),$(o).trim()!==""?(v(),f("a",{key:0,href:"#",onClick:T(i,["prevent"])},[y(r,{icon:"plus"})])):(v(),f("a",Y,[y(r,{icon:"ban"})]))])}}},ee={class:"todoList_label"},te=["checked"],oe={key:0,class:"form-control"},se=["value"],ne={__name:"TodoItem",props:["todo"],emits:["toggle","updateText","deleteHandler"],setup(c,{emit:k}){const n=D("status"),o=k,i=(r,t)=>{o("toggle",r,t)},h=(r,t)=>{console.log("孫層id:",r,"value:",t),o("updateText",r,t)},g=(r,t)=>{o("deleteHandler",r,t)};return(r,t)=>{const d=b("font-awesome-icon");return v(),f("li",null,[s("label",ee,[s("input",{class:"todoList_input",type:"checkbox",checked:c.todo.status,onClick:t[0]||(t[0]=T(u=>i(c.todo.id,u),["prevent"]))},null,8,te),c.todo.isEdit?A("",!0):(v(),f("span",oe,E(c.todo.content),1)),c.todo.isEdit?(v(),f("input",{key:1,class:"form-control",type:"text",value:c.todo.content,onBlur:t[1]||(t[1]=u=>c.todo.isEdit=!1),onKeyup:[t[2]||(t[2]=H(u=>h(c.todo.id,u.target.value),["enter"])),t[3]||(t[3]=H(u=>c.todo.isEdit=!1,["esc"]))]},null,40,se)):A("",!0)]),$(n)==="completed"?(v(),f("a",{key:0,href:"#",onClick:t[4]||(t[4]=T(u=>g(c.todo.id,u),["prevent"]))},[y(d,{icon:"times"})])):(v(),f("a",{key:1,href:"#",onClick:t[5]||(t[5]=T(u=>c.todo.isEdit=!0,["prevent"]))},[y(d,{icon:"pen-to-square"})]))])}}},ae={class:"todoList_list"},le={class:"todoList_tab"},ie={class:"todoList_items"},re={class:"todoList_item"},ce={key:0},ue={class:"todoList_statistics"},de={__name:"TodoList",props:["todos","todosView"],emits:["toggle","updateText","deleteHandler"],setup(c,{emit:k}){const n=D("status");console.log("status:",n);const o=D("unCompletedWork");console.log("unCompletedWork:",o);const i=k,h=t=>{i("toggle",t)},g=(t,d)=>{i("updateText",t,d)},r=t=>{i("deleteHandler",t)};return(t,d)=>(v(),f("div",ae,[s("ul",le,[s("li",null,[s("a",{href:"#",onClick:d[0]||(d[0]=T(u=>n.value="all",["prevent"])),class:B({active:$(n)==="all"})},"全部",2)]),s("li",null,[s("a",{href:"#",onClick:d[1]||(d[1]=T(u=>n.value="uncompleted",["prevent"])),class:B({active:$(n)==="uncompleted"})},"待完成",2)]),s("li",null,[s("a",{href:"#",onClick:d[2]||(d[2]=T(u=>n.value="completed",["prevent"])),class:B({active:$(n)==="completed"})},"已完成",2)])]),s("div",ie,[s("ul",re,[c.todos.length===0?(v(),f("li",ce,"目前無代辦事項 ")):A("",!0),(v(!0),f(q,null,R(c.todosView,u=>(v(),J(ne,{todo:u,key:u.id,onToggle:h,onUpdateText:g,onDeleteHandler:r},null,8,["todo"]))),128))]),s("div",ue,[s("p",null,E($(o))+" 個未完成項目",1)])])]))}};const ve={id:"todoListPage",class:"bg-half"},fe={class:"todo_sm"},me={href:"#"},ge={class:"conatiner todoListPage vhContainer"},pe={class:"todoList_Content"},x="https://todolist-api.hexschool.io",xe={__name:"TodoListView",setup(c){const k=G(),n=w(""),o=w("");L("isLoading",o);const i=w([]);V(()=>i.value.length>0);const h=w(null),g=w(""),r=w("all"),t=V(()=>i.value.filter(e=>e.status===!1).length),d=V(()=>{if(r.value==="all")return i.value;if(r.value==="uncompleted")return i.value.filter(e=>e.status===!1);if(r.value==="completed")return i.value.filter(e=>e.status===!0)}),u=async()=>{console.log("logout"),o.value=!0;try{let e=document.cookie.split(";").find(l=>l.trim().startsWith("token="));e=e.split("=")[1],console.log("token exists:",e);const a=await _.post(x+"/users/sign_out",{},{headers:{Authorization:`${e}`}});console.log("res.data:",a.data),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",o.value=!1,n.value="",h.value=null,C.fire({title:"成功登出",icon:"success",confirmButtonText:"確定"})}catch(e){console.log("登出失敗",e),C.fire({title:"登出失敗",text:`${e.data.message}！`,icon:"error",confirmButtonText:"確定"}),o.value=!1}},z=async()=>{console.log("checkOnline"),o.value=!0;try{const e=document.cookie.split(";");console.log("cookies:",e),n.value=e.find(l=>l.trim().startsWith("token=")).split("=")[1],n.value&&console.log("token exists:",n.value);const a=await _.get(x+"/users/checkout",{headers:{Authorization:`${n.value}`}});console.log(a.data),h.value=a.data,W()}catch{o.value=!1,C.fire({title:"不再線上 即將踢人",icon:"error",confirmButtonText:"確定"}).then(a=>{k.push("/login")})}};Q(()=>{console.log("TodoListView onMounted"),o.value=!1,z()});const W=async()=>{console.log("token:",n.value),o.value=!0;const e=await _.get(x+"/todos/",{headers:{Authorization:`${n.value}`}});console.log(e.data),e.data.data.forEach((a,l)=>{setTimeout(()=>{console.log("todo:",a),i.value.push(a),l===e.data.data.length-1&&(o.value=!1)},400*(l+1))}),e.data.data.length===0&&(o.value=!1)},N=async(e,a)=>{console.log("id:",e);const l=`${x}/todos/${e}/toggle`;console.log(l);try{const p=await _.patch(l,{},{headers:{Authorization:`${n.value}`}}),m=i.value.find(S=>S.id===e);m.status=!m.status,console.log(p.data)}catch{}},O=async(e,a)=>{console.log("updateText","id:",e,"newContent:",a);const l=`${x}/todos/${e}`;console.log(l),o.value=!0;try{const p=await _.put(l,{content:a},{headers:{Authorization:`${n.value}`}});p.status&&i.value.map(m=>(m.id===e&&(m.content=a,m.isEdit=!1),m)),console.log(p.data)}catch{}o.value=!1},U=async()=>{const e=`${x}/todos/`;console.log(e);const a=await _.post(e,{content:g.value},{headers:{Authorization:`${n.value}`}});console.log(a),a.status&&i.value.push(a.data.newTodo)},F=async e=>{console.log("id:",e);const a=i.value.find(l=>l.id===e);return C.fire({title:"確定要刪除這筆資料嗎？",text:`${a.content} 會被刪除`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(l=>{if(l.isConfirmed)return C.fire("刪除了！","資料已經被刪除。","success"),!0;if(l.isDismissed)return C.fire("取消刪除","資料未被刪除","info"),!1})},M=async(e,a)=>{if(!await F(e))return;console.log("id:",e);const l=`${x}/todos/${e}`;console.log(l);try{const p=await _.delete(l,{headers:{Authorization:`${n.value}`}});i.value=i.value.filter(m=>{if(m.id!=e)return m}),console.log(p.data)}catch{}};return L("createText",g),L("status",r),L("unCompletedWork",t),(e,a)=>{var l;return v(),f("div",ve,[y(I),s("nav",null,[a[0]||(a[0]=s("h1",null,[s("a",{href:"#"},"ONLINE TODO LIST")],-1)),s("ul",null,[s("li",fe,[s("a",me,[s("span",null,E((l=h.value)==null?void 0:l.nickname)+"的代辦",1)])]),s("li",null,[s("a",{onClick:u,href:"#loginPage"},"登出")])])]),s("div",ge,[s("div",pe,[y(Z,{onCreateData:U}),y(de,{todosView:d.value,todos:i.value,onToggle:N,onUpdateText:O,onDeleteHandler:M},null,8,["todosView","todos"])])])])}}};export{xe as default};
