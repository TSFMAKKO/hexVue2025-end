import{u as N,r,i as y,o as l,c as a,b as t,t as h,f as U,v as V,j as E,e as c,n as C,F as m,k as $,g as x}from"./index-b40e8e93.js";import{a as k}from"./axios-b5ee139b.js";const P={id:"todoListPage",class:"bg-half"},W={class:"todo_sm"},F={href:"#"},I={class:"conatiner todoListPage vhContainer"},K={class:"todoList_Content"},M={class:"inputBox"},S={class:"todoList_list"},j={class:"todoList_tab"},J={class:"todoList_items"},R={key:0,class:"todoList_item"},q={class:"todoList_label"},G=["checked","onClick"],H={key:1,class:"todoList_item"},Q={class:"todoList_label"},X=["checked","onClick"],Y={key:2,class:"todoList_item"},Z={class:"todoList_label"},tt=["checked","onClick"],et={class:"todoList_statistics"},_="https://todolist-api.hexschool.io",nt={__name:"TodoListView",setup(st){const w=N(),n=r(""),d=r(""),u=r([]),f=r(null),g=r(""),i=r("all"),T=y(()=>u.value.filter(s=>s.status===!0).length),A=y(()=>u.value.filter(s=>s.status===!0)),z=y(()=>u.value.filter(s=>s.status===!1)),D=async()=>{console.log("logout"),d.value=!0;try{let s=document.cookie.split(";").find(o=>o.trim().startsWith("token="));s=s.split("=")[1],console.log("token exists:",s);const e=await k.post(_+"/users/sign_out",{},{headers:{Authorization:`${s}`}});console.log("res.data:",e.data),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",n.value="",f.value=null,alert(`成功登出 ${e.data.message}`)}catch(s){alert(`登出失敗${s.data}`),console.log("登出失敗",s)}d.value=!1};(async()=>{console.log("checkOnline"),d.value=!0;try{const s=document.cookie.split(";");console.log("cookies:",s),n.value=s.find(o=>o.trim().startsWith("token=")).split("=")[1],n.value&&console.log("token exists:",n.value);const e=await k.get(_+"/users/checkout",{headers:{Authorization:`${n.value}`}});console.log(e.data),f.value=e.data,alert(`${e.data.nickname} 在線上`),O(),d.value=!1}catch{alert("不再線上 即將踢人"),w.push("/"),d.value=!1}})();const O=async()=>{console.log("token:",n.value);const s=await k.get(_+"/todos/",{headers:{Authorization:`${n.value}`}});console.log(s.data),s.data.data.forEach((e,o)=>{setTimeout(()=>{console.log("todo:",e),u.value.push(e)},200*o)})},L=async(s,e)=>{console.log("id:",s);const o=`${_}/todos/${s}/toggle`;console.log(o);try{const v=await k.patch(o,{},{headers:{Authorization:`${n.value}`}});let B=null;u.value.map(p=>(p.id===s&&(p.status=!p.status,B=p.status),p)),console.log(v.data)}catch{}console.log(u.value)},b=async()=>{const s=`${_}/todos/`;console.log(s);const e=await k.post(s,{content:g.value},{headers:{Authorization:`${n.value}`}});console.log(e),e.status&&u.value.push(e.data.newTodo)};return(s,e)=>(l(),a(m,null,[e[9]||(e[9]=t("h1",null,"todolis",-1)),t("div",P,[t("nav",null,[e[4]||(e[4]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",W,[t("a",F,[t("span",null,h(f.value.nickname)+"的代辦",1)])]),t("li",null,[t("a",{onClick:D,href:"#loginPage"},"登出")])])]),t("div",I,[t("div",K,[t("div",M,[U(t("input",{type:"text","onUpdate:modelValue":e[0]||(e[0]=o=>g.value=o),onKeypress:E(b,["enter"]),placeholder:"請輸入待辦事項"},null,544),[[V,g.value]]),t("a",{href:"#",onClick:c(b,["prevent"])},e[5]||(e[5]=[t("i",{class:"fa fa-plus"},null,-1)]))]),t("div",S,[t("ul",j,[t("li",null,[t("a",{href:"#",onClick:e[1]||(e[1]=c(o=>i.value="all",["prevent"])),class:C({active:i.value==="all"})},"全部",2)]),t("li",null,[t("a",{href:"#",onClick:e[2]||(e[2]=c(o=>i.value="uncompleted",["prevent"])),class:C({active:i.value==="uncompleted"})},"待完成",2)]),t("li",null,[t("a",{href:"#",onClick:e[3]||(e[3]=c(o=>i.value="completed",["prevent"])),class:C({active:i.value==="completed"})},"已完成",2)])]),t("div",J,[i.value==="all"?(l(),a("ul",R,[(l(!0),a(m,null,$(u.value,o=>(l(),a("li",null,[t("label",q,[t("input",{class:"todoList_input",type:"checkbox",checked:o.status,onClick:c(v=>L(o.id),["prevent"])},null,8,G),t("span",null,h(o.content),1)]),e[6]||(e[6]=t("a",{href:"#"},[t("i",{class:"fa fa-times"})],-1))]))),256))])):x("",!0),i.value==="uncompleted"?(l(),a("ul",H,[(l(!0),a(m,null,$(z.value,o=>(l(),a("li",null,[t("label",Q,[t("input",{class:"todoList_input",type:"checkbox",checked:o.status,onClick:c(v=>L(o.id),["prevent"])},null,8,X),t("span",null,h(o.content),1)]),e[7]||(e[7]=t("a",{href:"#"},[t("i",{class:"fa fa-times"})],-1))]))),256))])):x("",!0),i.value==="completed"?(l(),a("ul",Y,[(l(!0),a(m,null,$(A.value,o=>(l(),a("li",null,[t("label",Z,[t("input",{class:"todoList_input",type:"checkbox",checked:o.status,onClick:c(v=>L(o.id),["prevent"])},null,8,tt),t("span",null,h(o.content),1)]),e[8]||(e[8]=t("a",{href:"#"},[t("i",{class:"fa fa-times"})],-1))]))),256))])):x("",!0),t("div",et,[t("p",null,h(T.value)+" 個已完成項目",1)])])])])])])],64))}};export{nt as default};
