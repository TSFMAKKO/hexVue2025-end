import{_ as V,u as L,r as u,p as S,a as $,o as m,c as p,b as o,d as c,w,e as B,f as y,v as x,t as v,g as f,F as T,h as D}from"./index-1e75a4c9.js";import{_ as F,a as N}from"./isLoading-9e0f24f1.js";import{S as b}from"./sweetalert2.esm.all-263d9c0b.js";const U={id:"loginPage",class:"bg-yellow"},A={class:"conatiner loginPage vhContainer"},E={class:"side"},P={key:0,class:"error-message"},I={key:1,class:"error-message"},M={key:2,class:"error-message"},j="https://todolist-api.hexschool.io",R={__name:"LoginView",setup(q){const k=L(),n=u("example333@gmail.com"),r=u("example"),s=u({email:"",password:"",login:""}),d=u(!1),g=u("");S("isLoading",d);const _=(t,e)=>t.value?(s.value[t.key]="",!0):(s.value[t.key]=e,!1),h=()=>{s.value={};const t=_({value:n.value,key:"email"},"請填寫 email"),e=_({value:r.value,key:"password"},"請填寫密碼");return t&&e},C=async()=>{var t,e,i,l;if(h()){console.log("登入資訊:",{email:n.value,password:r.value}),console.log("login"),d.value=!0;try{const a=await N.post(j+"/users/sign_in",{email:n.value,password:r.value});console.log("res:",a.data),g.value=a.data.token,console.log(g.value),b.fire({title:"登入成功",text:`${a.data.nickname} 歡迎回來`,icon:"success",confirmButtonText:"確定"}).then(z=>{k.push("/todos")}),document.cookie=`token=${g.value}; expires=${new Date(Date.now()+3600*1e3).toUTCString()}; path=/`,d.value=!1}catch(a){a.response&&a.response.data?Array.isArray((e=(t=a.response)==null?void 0:t.data)==null?void 0:e.message)?s.value.login=a.response.data.message.join(", "):typeof((l=(i=a.response)==null?void 0:i.data)==null?void 0:l.message)=="string"?s.value.login=a.response.data.message:s.value.login="發生未知錯誤":s.value.login="登入失敗，請稍後再試",alert(`登入失敗${s.value.login}`),b.fire({title:"登入失敗",text:`${s.value.login}`,icon:"error",confirmButtonText:"重新輸入"}),console.error("登入失敗:",a),d.value=!1;return}}};return(t,e)=>{const i=$("router-link");return m(),p(T,null,[o("div",null,[o("div",U,[o("div",A,[o("div",E,[c(i,{to:"/"},{default:w(()=>[...e[2]||(e[2]=[o("img",{class:"logoImg",src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/logo.png",alt:"待辦事項"},null,-1)])]),_:1}),e[3]||(e[3]=o("img",{class:"d-m-n",src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/img.png",alt:"工作圖片"},null,-1))]),o("div",null,[o("form",{class:"formControls",onSubmit:B(C,["prevent"])},[e[5]||(e[5]=o("h2",{class:"formControls_txt"},"最實用的線上代辦事項服務",-1)),e[6]||(e[6]=o("label",{class:"formControls_label",for:"email"},"Email",-1)),y(o("input",{class:"formControls_input",type:"email",id:"email","onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),placeholder:"請輸入 email"},null,512),[[x,n.value]]),s.value.email?(m(),p("span",P,v(s.value.email),1)):f("",!0),e[7]||(e[7]=o("label",{class:"formControls_label",for:"pwd"},"密碼",-1)),y(o("input",{class:"formControls_input",type:"password",id:"pwd","onUpdate:modelValue":e[1]||(e[1]=l=>r.value=l),placeholder:"請輸入密碼"},null,512),[[x,r.value]]),s.value.password?(m(),p("span",I,v(s.value.password),1)):f("",!0),s.value.login?(m(),p("span",M,v(s.value.login),1)):f("",!0),e[8]||(e[8]=o("button",{type:"submit",class:"formControls_btnSubmit"},"登入",-1)),c(i,{to:"/signup",class:"formControls_btnLink"},{default:w(()=>[...e[4]||(e[4]=[D("註冊帳號",-1)])]),_:1})],32)])])])]),c(F)],64)}}},K=V(R,[["__scopeId","data-v-22d3419a"]]);export{K as default};
