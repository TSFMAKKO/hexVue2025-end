import{_ as I,a as _}from"./isLoading-26c9f860.js";import{i as D,a as z,o as v,c as f,f as K,v as P,j as $,b as s,k as j,l as A,e as T,d as y,t as b,g as E,n as V,F as q,m as R,q as J,u as G,r as C,p as B,s as H,x as Q}from"./index-5b83d221.js";import{S as L}from"./sweetalert2.esm.all-263d9c0b.js";const X={class:"inputBox"},Y={key:1,href:"#"},Z={__name:"TodoForm",emits:{createData:Function},setup(c,{emit:k}){const n=k,o=D("createText"),a=()=>{o.value.trim()!==""&&(n("createData"),o.value="")};return(p,g)=>{const r=z("font-awesome-icon");return v(),f("div",X,[K(s("input",{type:"text","onUpdate:modelValue":g[0]||(g[0]=t=>j(o)?o.value=t:null),onKeypress:A(a,["enter"]),placeholder:"請輸入待辦事項"},null,544),[[P,$(o)]]),$(o).trim()!==""?(v(),f("a",{key:0,href:"#",onClick:T(a,["prevent"])},[y(r,{icon:"plus"})])):(v(),f("a",Y,[y(r,{icon:"ban"})]))])}}},ee={class:"todoList_label"},te=["checked"],oe={key:0,class:"form-control"},se=["value"],ne={__name:"TodoItem2",props:["todo"],emits:["toggle","updateText","deleteHandler"],setup(c,{emit:k}){D("isLoading");const n=D("status"),o=k,a=(r,t)=>{o("toggle",r,t)},p=(r,t)=>{console.log("孫層id:",r,"value:",t.target.value),o("updateText",r,t.target.value),o("updateText",r,t)},g=(r,t)=>{o("deleteHandler",r,t)};return(r,t)=>{const d=z("font-awesome-icon");return v(),f("li",null,[s("label",ee,[s("input",{class:"todoList_input",type:"checkbox",checked:c.todo.status,onClick:t[0]||(t[0]=T(u=>a(c.todo.id,u),["prevent"]))},null,8,te),c.todo.isEdit?E("",!0):(v(),f("span",oe,b(c.todo.content),1)),c.todo.isEdit?(v(),f("input",{key:1,class:"form-control",type:"text",value:c.todo.content,onBlur:t[1]||(t[1]=u=>c.todo.isEdit=!1),onKeyup:[t[2]||(t[2]=A(u=>p(c.todo.id,u),["enter"])),t[3]||(t[3]=A(u=>c.todo.isEdit=!1,["esc"]))]},null,40,se)):E("",!0)]),$(n)==="completed"?(v(),f("a",{key:0,href:"#",onClick:t[4]||(t[4]=T(u=>g(c.todo.id,u),["prevent"]))},[y(d,{icon:"times"})])):(v(),f("a",{key:1,href:"#",onClick:t[5]||(t[5]=T(u=>c.todo.isEdit=!0,["prevent"]))},[y(d,{icon:"pen-to-square"})]))])}}},ae={class:"todoList_list"},le={class:"todoList_tab"},ie={class:"todoList_items"},re={class:"todoList_item"},ce={key:0},ue={class:"todoList_statistics"},de={__name:"TodoList",props:["todos","todosView"],emits:["toggle","updateText","deleteHandler"],setup(c,{emit:k}){const n=D("status");console.log("status:",n);const o=D("unCompletedWork");console.log("unCompletedWork:",o);const a=k,p=t=>{a("toggle",t)},g=(t,d)=>{a("updateText",t,d)},r=t=>{a("deleteHandler",t)};return(t,d)=>(v(),f("div",ae,[s("ul",le,[s("li",null,[s("a",{href:"#",onClick:d[0]||(d[0]=T(u=>n.value="all",["prevent"])),class:V({active:$(n)==="all"})},"全部",2)]),s("li",null,[s("a",{href:"#",onClick:d[1]||(d[1]=T(u=>n.value="uncompleted",["prevent"])),class:V({active:$(n)==="uncompleted"})},"待完成",2)]),s("li",null,[s("a",{href:"#",onClick:d[2]||(d[2]=T(u=>n.value="completed",["prevent"])),class:V({active:$(n)==="completed"})},"已完成",2)])]),s("div",ie,[s("ul",re,[c.todos.length===0?(v(),f("li",ce,"目前無代辦事項 ")):E("",!0),(v(!0),f(q,null,R(c.todosView,u=>(v(),J(ne,{todo:u,key:u.id,onToggle:p,onUpdateText:g,onDeleteHandler:r},null,8,["todo"]))),128))]),s("div",ue,[s("p",null,b($(o))+" 個未完成項目",1)])])]))}};const ve={id:"todoListPage",class:"bg-half"},fe={class:"todo_sm"},ge={href:"#"},me={class:"conatiner todoListPage vhContainer"},pe={class:"todoList_Content"},x="https://todolist-api.hexschool.io",xe={__name:"TodoListView",setup(c){const k=G(),n=C(""),o=C("");B("isLoading",o);const a=C([]);H(()=>a.value.length>0);const p=C(null),g=C(""),r=C("all"),t=H(()=>a.value.filter(e=>e.status===!1).length),d=H(()=>{if(r.value==="all")return a.value;if(r.value==="uncompleted")return a.value.filter(e=>e.status===!1);if(r.value==="completed")return a.value.filter(e=>e.status===!0)}),u=async()=>{console.log("logout"),o.value=!0;try{let e=document.cookie.split(";").find(l=>l.trim().startsWith("token="));e=e.split("=")[1],console.log("token exists:",e);const i=await _.post(x+"/users/sign_out",{},{headers:{Authorization:`${e}`}});console.log("res.data:",i.data),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",o.value=!1,n.value="",p.value=null,L.fire({title:"成功登出",icon:"success",confirmButtonText:"確定"})}catch(e){console.log("登出失敗",e),L.fire({title:"登出失敗",text:`${e.data.message}！`,icon:"error",confirmButtonText:"確定"}),o.value=!1}},W=async()=>{console.log("checkOnline"),o.value=!0;try{const e=document.cookie.split(";");console.log("cookies:",e),n.value=e.find(l=>l.trim().startsWith("token=")).split("=")[1],n.value&&console.log("token exists:",n.value);const i=await _.get(x+"/users/checkout",{headers:{Authorization:`${n.value}`}});console.log(i.data),p.value=i.data,N()}catch{o.value=!1,L.fire({title:"不再線上 即將踢人",icon:"error",confirmButtonText:"確定"}).then(i=>{k.push("/login")})}};Q(()=>{console.log("TodoListView onMounted"),o.value=!1,W()});const N=async()=>{console.log("token:",n.value),o.value=!0;const e=await _.get(x+"/todos/",{headers:{Authorization:`${n.value}`}});console.log(e.data),e.data.data.forEach((i,l)=>{setTimeout(()=>{console.log("todo:",i),a.value.push(i),l===e.data.data.length-1&&(o.value=!1)},400*(l+1))}),e.data.data.length===0&&(o.value=!1)},O=async(e,i)=>{console.log("id:",e);const l=`${x}/todos/${e}/toggle`;console.log(l);try{const h=await _.patch(l,{},{headers:{Authorization:`${n.value}`}}),m=a.value.find(w=>w.id===e);m.status=!m.status,console.log(h.data)}catch{}},U=async(e,i)=>{console.log("updateText","id:",e);const l=i.target.value,h=`${x}/todos/${e}`;console.log(h),o.value=!0;try{const m=await _.put(h,{content:l},{headers:{Authorization:`${n.value}`}});m.status&&a.value.map(w=>(w.id===e&&(w.content=l,w.isEdit=!1),w)),console.log(m.data)}catch{}o.value=!1,console.log(a.value)},F=async()=>{const e=`${x}/todos/`;console.log(e);const i=await _.post(e,{content:g.value},{headers:{Authorization:`${n.value}`}});console.log(i),i.status&&a.value.push(i.data.newTodo)},M=async e=>{console.log("id:",e);const i=a.value.find(l=>l.id===e);return L.fire({title:"確定要刪除這筆資料嗎？",text:`${i.content} 會被刪除`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(l=>{if(l.isConfirmed)return L.fire("刪除了！","資料已經被刪除。","success"),!0;if(l.isDismissed)return L.fire("取消刪除","資料未被刪除","info"),!1})},S=async(e,i)=>{if(!await M(e))return;console.log("id:",e);const l=`${x}/todos/${e}`;console.log(l);try{const h=await _.delete(l,{headers:{Authorization:`${n.value}`}});a.value=a.value.filter(m=>{if(m.id!=e)return m}),console.log(h.data)}catch{}};return B("createText",g),B("status",r),B("unCompletedWork",t),(e,i)=>{var l;return v(),f("div",ve,[y(I),s("nav",null,[i[0]||(i[0]=s("h1",null,[s("a",{href:"#"},"ONLINE TODO LIST")],-1)),s("ul",null,[s("li",fe,[s("a",ge,[s("span",null,b((l=p.value)==null?void 0:l.nickname)+"的代辦",1)])]),s("li",null,[s("a",{onClick:u,href:"#loginPage"},"登出")])])]),s("div",me,[s("div",pe,[y(Z,{onCreateData:F}),y(de,{todosView:d.value,todos:a.value,onToggle:O,onUpdateText:U,onDeleteHandler:S},null,8,["todosView","todos"])])])])}}};export{xe as default};
