import{u as U,r as k,i as x,a as P,o as a,c as i,b as s,t as f,f as W,v as q,j as m,e as d,d as y,n as w,F as E,k as b,g as p}from"./index-eccddcfb.js";import{a as h}from"./axios-b5ee139b.js";const F={id:"todoListPage",class:"bg-half"},I={class:"todo_sm"},M={href:"#"},S={class:"conatiner todoListPage vhContainer"},j={class:"todoList_Content"},H={class:"inputBox"},J={class:"todoList_list"},R={class:"todoList_tab"},G={class:"todoList_items"},Q={key:0,class:"todoList_item"},X={class:"todoList_label"},Y=["checked","onClick"],Z={key:0,class:"form-control"},ee=["value","onBlur","onKeyup"],te=["onClick"],se={key:1,class:"todoList_item"},oe={class:"todoList_label"},le=["checked","onClick"],ne={key:0,class:"form-control"},ae=["value","onBlur","onKeyup"],ie=["onClick"],ce={key:2,class:"todoList_item"},ue={class:"todoList_label"},re=["checked","onClick"],de={class:"form-control"},ve=["onClick"],pe={class:"todoList_statistics"},_="https://todolist-api.hexschool.io",fe={__name:"TodoListView",setup(he){const z=U(),u=k(""),g=k(""),c=k([]),$=k(null),C=k(""),v=k("all"),B=x(()=>c.value.filter(t=>t.status===!0).length),D=x(()=>c.value.filter(t=>t.status===!0)),K=x(()=>c.value.filter(t=>t.status===!1)),O=async()=>{console.log("logout"),g.value=!0;try{let t=document.cookie.split(";").find(n=>n.trim().startsWith("token="));t=t.split("=")[1],console.log("token exists:",t);const o=await h.post(_+"/users/sign_out",{},{headers:{Authorization:`${t}`}});console.log("res.data:",o.data),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",u.value="",$.value=null,alert(`成功登出 ${o.data.message}`)}catch(t){alert(`登出失敗${t.data}`),console.log("登出失敗",t)}g.value=!1};(async()=>{console.log("checkOnline"),g.value=!0;try{const t=document.cookie.split(";");console.log("cookies:",t),u.value=t.find(n=>n.trim().startsWith("token=")).split("=")[1],u.value&&console.log("token exists:",u.value);const o=await h.get(_+"/users/checkout",{headers:{Authorization:`${u.value}`}});console.log(o.data),$.value=o.data,V(),g.value=!1}catch{alert("不再線上 即將踢人"),z.push("/login"),g.value=!1}})();const V=async()=>{console.log("token:",u.value);const t=await h.get(_+"/todos/",{headers:{Authorization:`${u.value}`}});console.log(t.data),t.data.data.forEach((o,n)=>{setTimeout(()=>{console.log("todo:",o),c.value.push(o)},200*n)})},L=async(t,o)=>{console.log("id:",t);const n=`${_}/todos/${t}/toggle`;console.log(n);try{const e=await h.patch(n,{},{headers:{Authorization:`${u.value}`}});let l=null;c.value.map(r=>(r.id===t&&(r.status=!r.status,l=r.status),r)),console.log(e.data)}catch{}console.log(c.value)},T=async(t,o)=>{console.log("updateText","id:",t);const n=o.target.value,e=`${_}/todos/${t}`;console.log(e);try{const l=await h.put(e,{content:n},{headers:{Authorization:`${u.value}`}});l.status&&c.value.map(r=>(r.id===t&&(r.content=n,r.isEdit=!1),r)),o.target.value=n,console.log(l.data)}catch{}console.log(c.value)},A=async()=>{const t=`${_}/todos/`;console.log(t);const o=await h.post(t,{content:C.value},{headers:{Authorization:`${u.value}`}});console.log(o),o.status&&c.value.push(o.data.newTodo)},N=async(t,o)=>{if(!confirm("確認刪除"))return;console.log("id:",t);const n=`${_}/todos/${t}`;console.log(n);try{const e=await h.delete(n,{headers:{Authorization:`${u.value}`}});c.value=c.value.filter(l=>{if(l.id!=t)return l}),console.log(e.data)}catch{}console.log(c.value)};return(t,o)=>{const n=P("font-awesome-icon");return a(),i("div",F,[s("nav",null,[o[4]||(o[4]=s("h1",null,[s("a",{href:"#"},"ONLINE TODO LIST")],-1)),s("ul",null,[s("li",I,[s("a",M,[s("span",null,f($.value.nickname)+"的代辦",1)])]),s("li",null,[s("a",{onClick:O,href:"#loginPage"},"登出")])])]),s("div",S,[s("div",j,[s("div",H,[W(s("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>C.value=e),onKeypress:m(A,["enter"]),placeholder:"請輸入待辦事項"},null,544),[[q,C.value]]),s("a",{href:"#",onClick:d(A,["prevent"])},[y(n,{icon:"plus"})])]),s("div",J,[s("ul",R,[s("li",null,[s("a",{href:"#",onClick:o[1]||(o[1]=d(e=>v.value="all",["prevent"])),class:w({active:v.value==="all"})},"全部",2)]),s("li",null,[s("a",{href:"#",onClick:o[2]||(o[2]=d(e=>v.value="uncompleted",["prevent"])),class:w({active:v.value==="uncompleted"})},"待完成",2)]),s("li",null,[s("a",{href:"#",onClick:o[3]||(o[3]=d(e=>v.value="completed",["prevent"])),class:w({active:v.value==="completed"})},"已完成",2)])]),s("div",G,[v.value==="all"?(a(),i("ul",Q,[(a(!0),i(E,null,b(c.value,e=>(a(),i("li",null,[s("label",X,[s("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:d(l=>L(e.id),["prevent"])},null,8,Y),e.isEdit?p("",!0):(a(),i("span",Z,f(e.content),1)),e.isEdit?(a(),i("input",{key:1,class:"form-control",type:"text",value:e.content,onBlur:l=>e.isEdit=!1,onKeyup:[m(l=>T(e.id,l),["enter"]),m(l=>e.isEdit=!1,["esc"])]},null,40,ee)):p("",!0)]),s("a",{href:"#",onClick:d(l=>e.isEdit=!0,["prevent"])},[y(n,{icon:"pen-to-square"})],8,te)]))),256))])):p("",!0),v.value==="uncompleted"?(a(),i("ul",se,[(a(!0),i(E,null,b(K.value,e=>(a(),i("li",null,[s("label",oe,[s("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:d(l=>L(e.id),["prevent"])},null,8,le),e.isEdit?p("",!0):(a(),i("span",ne,f(e.content),1)),e.isEdit?(a(),i("input",{key:1,class:"form-control",type:"text",value:e.content,onBlur:l=>e.isEdit=!1,onKeyup:[m(l=>T(e.id,l),["enter"]),m(l=>e.isEdit=!1,["esc"])]},null,40,ae)):p("",!0)]),s("a",{href:"#",onClick:d(l=>e.isEdit=!0,["prevent"])},[y(n,{icon:"pen-to-square"})],8,ie)]))),256))])):p("",!0),v.value==="completed"?(a(),i("ul",ce,[(a(!0),i(E,null,b(D.value,e=>(a(),i("li",null,[s("label",ue,[s("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:d(l=>L(e.id),["prevent"])},null,8,re),s("span",de,f(e.content),1)]),s("a",{href:"#",onClick:d(l=>N(e.id),["prevent"])},[y(n,{icon:"times"})],8,ve)]))),256))])):p("",!0),s("div",pe,[s("p",null,f(B.value)+" 個已完成項目",1)])])])])])])}}};export{fe as default};
