import{u as U,r as k,i as x,o as n,c as a,b as t,t as f,f as V,v as P,j as m,e as r,n as b,F as w,k as E,g as p}from"./index-5bcc7368.js";import{a as h}from"./axios-b5ee139b.js";const W={id:"todoListPage",class:"bg-half"},F={class:"todo_sm"},I={href:"#"},M={class:"conatiner todoListPage vhContainer"},S={class:"todoList_Content"},j={class:"inputBox"},H={class:"todoList_list"},J={class:"todoList_tab"},R={class:"todoList_items"},q={key:0,class:"todoList_item"},G={class:"todoList_label"},Q=["checked","onClick"],X={key:0},Y=["value","onBlur","onKeyup"],Z=["onClick"],ee={key:1,class:"todoList_item"},te={class:"todoList_label"},se=["checked","onClick"],le={key:0},oe=["value","onBlur","onKeyup"],ne=["onClick"],ae={key:2,class:"todoList_item"},ie={class:"todoList_label"},ce=["checked","onClick"],ue=["onClick"],re={class:"todoList_statistics"},_="https://todolist-api.hexschool.io",_e={__name:"TodoListView",setup(de){const A=U(),c=k(""),g=k(""),i=k([]),$=k(null),C=k(""),d=k("all"),z=x(()=>i.value.filter(s=>s.status===!0).length),B=x(()=>i.value.filter(s=>s.status===!0)),D=x(()=>i.value.filter(s=>s.status===!1)),K=async()=>{console.log("logout"),g.value=!0;try{let s=document.cookie.split(";").find(e=>e.trim().startsWith("token="));s=s.split("=")[1],console.log("token exists:",s);const l=await h.post(_+"/users/sign_out",{},{headers:{Authorization:`${s}`}});console.log("res.data:",l.data),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",c.value="",$.value=null,alert(`成功登出 ${l.data.message}`)}catch(s){alert(`登出失敗${s.data}`),console.log("登出失敗",s)}g.value=!1};(async()=>{console.log("checkOnline"),g.value=!0;try{const s=document.cookie.split(";");console.log("cookies:",s),c.value=s.find(e=>e.trim().startsWith("token=")).split("=")[1],c.value&&console.log("token exists:",c.value);const l=await h.get(_+"/users/checkout",{headers:{Authorization:`${c.value}`}});console.log(l.data),$.value=l.data,O(),g.value=!1}catch{alert("不再線上 即將踢人"),A.push("/login"),g.value=!1}})();const O=async()=>{console.log("token:",c.value);const s=await h.get(_+"/todos/",{headers:{Authorization:`${c.value}`}});console.log(s.data),s.data.data.forEach((l,e)=>{setTimeout(()=>{console.log("todo:",l),i.value.push(l)},200*e)})},L=async(s,l)=>{console.log("id:",s);const e=`${_}/todos/${s}/toggle`;console.log(e);try{const o=await h.patch(e,{},{headers:{Authorization:`${c.value}`}});let v=null;i.value.map(u=>(u.id===s&&(u.status=!u.status,v=u.status),u)),console.log(o.data)}catch{}console.log(i.value)},y=async(s,l)=>{console.log("updateText","id:",s);const e=l.target.value,o=`${_}/todos/${s}`;console.log(o);try{const v=await h.put(o,{content:e},{headers:{Authorization:`${c.value}`}});v.status&&i.value.map(u=>(u.id===s&&(u.content=e,u.isEdit=!1),u)),l.target.value=e,console.log(v.data)}catch{}console.log(i.value)},T=async()=>{const s=`${_}/todos/`;console.log(s);const l=await h.post(s,{content:C.value},{headers:{Authorization:`${c.value}`}});console.log(l),l.status&&i.value.push(l.data.newTodo)},N=async(s,l)=>{if(!confirm("確認刪除"))return;console.log("id:",s);const e=`${_}/todos/${s}`;console.log(e);try{const o=await h.delete(e,{headers:{Authorization:`${c.value}`}});i.value=i.value.filter(v=>{if(v.id!=s)return v}),console.log(o.data)}catch{}console.log(i.value)};return(s,l)=>(n(),a("div",W,[t("nav",null,[l[4]||(l[4]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",F,[t("a",I,[t("span",null,f($.value.nickname)+"的代辦",1)])]),t("li",null,[t("a",{onClick:K,href:"#loginPage"},"登出")])])]),t("div",M,[t("div",S,[t("div",j,[V(t("input",{type:"text","onUpdate:modelValue":l[0]||(l[0]=e=>C.value=e),onKeypress:m(T,["enter"]),placeholder:"請輸入待辦事項"},null,544),[[P,C.value]]),t("a",{href:"#",onClick:r(T,["prevent"])},l[5]||(l[5]=[t("i",{class:"fa fa-plus"},null,-1)]))]),t("div",H,[t("ul",J,[t("li",null,[t("a",{href:"#",onClick:l[1]||(l[1]=r(e=>d.value="all",["prevent"])),class:b({active:d.value==="all"})},"全部",2)]),t("li",null,[t("a",{href:"#",onClick:l[2]||(l[2]=r(e=>d.value="uncompleted",["prevent"])),class:b({active:d.value==="uncompleted"})},"待完成",2)]),t("li",null,[t("a",{href:"#",onClick:l[3]||(l[3]=r(e=>d.value="completed",["prevent"])),class:b({active:d.value==="completed"})},"已完成",2)])]),t("div",R,[d.value==="all"?(n(),a("ul",q,[(n(!0),a(w,null,E(i.value,e=>(n(),a("li",null,[t("label",G,[t("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:r(o=>L(e.id),["prevent"])},null,8,Q),e.isEdit?p("",!0):(n(),a("span",X,f(e.content),1)),e.isEdit?(n(),a("input",{key:1,type:"text",value:e.content,onBlur:o=>y(e.id,o),onKeyup:[m(o=>y(e.id,o),["enter"]),m(o=>e.isEdit=!1,["esc"])]},null,40,Y)):p("",!0)]),t("a",{href:"#",onClick:r(o=>e.isEdit=!0,["prevent"])},l[6]||(l[6]=[t("i",{class:"fa fa-times"},"編輯",-1)]),8,Z)]))),256))])):p("",!0),d.value==="uncompleted"?(n(),a("ul",ee,[(n(!0),a(w,null,E(D.value,e=>(n(),a("li",null,[t("label",te,[t("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:r(o=>L(e.id),["prevent"])},null,8,se),e.isEdit?p("",!0):(n(),a("span",le,f(e.content),1)),e.isEdit?(n(),a("input",{key:1,type:"text",value:e.content,onBlur:o=>y(e.id,o),onKeyup:[m(o=>y(e.id,o),["enter"]),m(o=>e.isEdit=!1,["esc"])]},null,40,oe)):p("",!0)]),t("a",{href:"#",onClick:r(o=>e.isEdit=!0,["prevent"])},l[7]||(l[7]=[t("i",{class:"fa fa-times"},"編輯",-1)]),8,ne)]))),256))])):p("",!0),d.value==="completed"?(n(),a("ul",ae,[(n(!0),a(w,null,E(B.value,e=>(n(),a("li",null,[t("label",ie,[t("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:r(o=>L(e.id),["prevent"])},null,8,ce),t("span",null,f(e.content),1)]),t("a",{href:"#",onClick:r(o=>N(e.id),["prevent"])},l[8]||(l[8]=[t("i",{class:"fa fa-times"},"刪除",-1)]),8,ue)]))),256))])):p("",!0),t("div",re,[t("p",null,f(z.value)+" 個已完成項目",1)])])])])])]))}};export{_e as default};
