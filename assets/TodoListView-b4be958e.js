import{u as M,r as _,p as S,i as $,j as P,a as U,o as d,c as v,d as m,b as s,t as x,f as W,v as F,k as w,e as f,n as C,F as I,l as j,g as L}from"./index-e95ffad8.js";import{_ as q,a as h}from"./isLoading-36c3e7fd.js";import{S as g}from"./sweetalert2.esm.all-263d9c0b.js";const H={id:"todoListPage",class:"bg-half"},J={class:"todo_sm"},R={href:"#"},G={class:"conatiner todoListPage vhContainer"},Q={class:"todoList_Content"},X={class:"inputBox"},Y={key:1,href:"#"},Z={class:"todoList_list"},ee={class:"todoList_tab"},te={class:"todoList_items"},oe={class:"todoList_item"},se={class:"todoList_label"},ne=["checked","onClick"],le={key:0,class:"form-control"},ae=["value","onBlur","onKeyup"],ie=["onClick"],ce=["onClick"],re={key:0},ue={class:"todoList_statistics"},p="https://todolist-api.hexschool.io",pe={__name:"TodoListView",setup(de){const B=M(),i=_(""),r=_("");S("isLoading",r);const l=_([]);$(()=>l.value.length>0);const y=_(null),k=_(""),u=_("all"),A=$(()=>l.value.filter(e=>e.status===!1).length),E=$(()=>{if(u.value==="all")return l.value;if(u.value==="uncompleted")return l.value.filter(e=>e.status===!1);if(u.value==="completed")return l.value.filter(e=>e.status===!0)}),b=async()=>{console.log("logout"),r.value=!0;try{let e=document.cookie.split(";").find(n=>n.trim().startsWith("token="));e=e.split("=")[1],console.log("token exists:",e);const t=await h.post(p+"/users/sign_out",{},{headers:{Authorization:`${e}`}});console.log("res.data:",t.data),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",r.value=!1,i.value="",y.value=null,g.fire({title:"成功登出",icon:"success",confirmButtonText:"確定"})}catch(e){console.log("登出失敗",e),g.fire({title:"登出失敗",text:`${e.data.message}！`,icon:"error",confirmButtonText:"確定"}),r.value=!1}},z=async()=>{console.log("checkOnline"),r.value=!0;try{const e=document.cookie.split(";");console.log("cookies:",e),i.value=e.find(n=>n.trim().startsWith("token=")).split("=")[1],i.value&&console.log("token exists:",i.value);const t=await h.get(p+"/users/checkout",{headers:{Authorization:`${i.value}`}});console.log(t.data),y.value=t.data,D()}catch{g.fire({title:"不再線上 即將踢人",icon:"error",confirmButtonText:"確定"}).then(t=>{B.push("/login"),r.value=!1})}};P(()=>{console.log("TodoListView onMounted"),r.value=!1,z()});const D=async()=>{console.log("token:",i.value),r.value=!0;const e=await h.get(p+"/todos/",{headers:{Authorization:`${i.value}`}});console.log(e.data),e.data.data.forEach((t,n)=>{setTimeout(()=>{console.log("todo:",t),l.value.push(t),n===e.data.data.length-1&&(r.value=!1)},400*(n+1))}),e.data.data.length===0&&(r.value=!1)},V=async(e,t)=>{console.log("id:",e);const n=`${p}/todos/${e}/toggle`;console.log(n);try{const c=await h.patch(n,{},{headers:{Authorization:`${i.value}`}}),o=l.value.find(a=>a.id===e);o.status=!o.status,console.log(c.data)}catch{}console.log(l.value)},N=async(e,t)=>{console.log("updateText","id:",e);const n=t.target.value,c=`${p}/todos/${e}`;console.log(c);try{const o=await h.put(c,{content:n},{headers:{Authorization:`${i.value}`}});o.status&&l.value.map(a=>(a.id===e&&(a.content=n,a.isEdit=!1),a)),t.target.value=n,console.log(o.data)}catch{}console.log(l.value)},T=async()=>{const e=`${p}/todos/`;console.log(e);const t=await h.post(e,{content:k.value},{headers:{Authorization:`${i.value}`}});console.log(t),t.status&&l.value.push(t.data.newTodo)},O=async e=>{console.log("id:",e);const t=l.value.find(n=>n.id===e);return g.fire({title:"確定要刪除這筆資料嗎？",text:`${t.content} 會被刪除`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(n=>{if(n.isConfirmed)return g.fire("刪除了！","資料已經被刪除。","success"),!0;if(n.isDismissed)return g.fire("取消刪除","資料未被刪除","info"),!1})},K=async(e,t)=>{if(!await O(e))return;console.log("id:",e);const n=`${p}/todos/${e}`;console.log(n);try{const c=await h.delete(n,{headers:{Authorization:`${i.value}`}});l.value=l.value.filter(o=>{if(o.id!=e)return o}),console.log(c.data)}catch{}console.log(l.value)};return(e,t)=>{var c;const n=U("font-awesome-icon");return d(),v("div",H,[m(q),s("nav",null,[t[4]||(t[4]=s("h1",null,[s("a",{href:"#"},"ONLINE TODO LIST")],-1)),s("ul",null,[s("li",J,[s("a",R,[s("span",null,x((c=y.value)==null?void 0:c.nickname)+"的代辦",1)])]),s("li",null,[s("a",{onClick:b,href:"#loginPage"},"登出")])])]),s("div",G,[s("div",Q,[s("div",X,[W(s("input",{type:"text","onUpdate:modelValue":t[0]||(t[0]=o=>k.value=o),onKeypress:w(T,["enter"]),placeholder:"請輸入待辦事項"},null,544),[[F,k.value]]),k.value.trim()!==""?(d(),v("a",{key:0,href:"#",onClick:f(T,["prevent"])},[m(n,{icon:"plus"})])):(d(),v("a",Y,[m(n,{icon:"ban"})]))]),s("div",Z,[s("ul",ee,[s("li",null,[s("a",{href:"#",onClick:t[1]||(t[1]=f(o=>u.value="all",["prevent"])),class:C({active:u.value==="all"})},"全部",2)]),s("li",null,[s("a",{href:"#",onClick:t[2]||(t[2]=f(o=>u.value="uncompleted",["prevent"])),class:C({active:u.value==="uncompleted"})},"待完成",2)]),s("li",null,[s("a",{href:"#",onClick:t[3]||(t[3]=f(o=>u.value="completed",["prevent"])),class:C({active:u.value==="completed"})},"已完成",2)])]),s("div",te,[s("ul",oe,[(d(!0),v(I,null,j(E.value,o=>(d(),v("li",{key:o.id},[s("label",se,[s("input",{class:"todoList_input",type:"checkbox",checked:o.status,onClick:f(a=>V(o.id),["prevent"])},null,8,ne),o.isEdit?L("",!0):(d(),v("span",le,x(o.content),1)),o.isEdit?(d(),v("input",{key:1,class:"form-control",type:"text",value:o.content,onBlur:a=>o.isEdit=!1,onKeyup:[w(a=>N(o.id,a),["enter"]),w(a=>o.isEdit=!1,["esc"])]},null,40,ae)):L("",!0)]),u.value==="completed"?(d(),v("a",{key:0,href:"#",onClick:f(a=>K(o.id),["prevent"])},[m(n,{icon:"times"})],8,ie)):(d(),v("a",{key:1,href:"#",onClick:f(a=>o.isEdit=!0,["prevent"])},[m(n,{icon:"pen-to-square"})],8,ce))]))),128)),l.value.length===0?(d(),v("li",re,"目前無代辦事項 ")):L("",!0)]),s("div",ue,[s("p",null,x(A.value)+" 個未完成項目",1)])])])])])])}}};export{pe as default};
