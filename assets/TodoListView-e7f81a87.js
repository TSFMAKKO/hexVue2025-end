import{u as W,r as k,p as q,i as x,a as F,o as a,c as i,d as m,b as s,t as y,f as I,v as M,j as $,e as d,n as T,F as b,k as B,g as h}from"./index-35797c72.js";import{_ as j,a as _}from"./isLoading-c2b9a7b2.js";import{S as g}from"./sweetalert2.esm.all-263d9c0b.js";const H={id:"todoListPage",class:"bg-half"},J={class:"todo_sm"},R={href:"#"},G={class:"conatiner todoListPage vhContainer"},Q={class:"todoList_Content"},X={class:"inputBox"},Y={key:1,href:"#"},Z={class:"todoList_list"},ee={class:"todoList_tab"},te={class:"todoList_items"},se={key:0,class:"todoList_item"},oe={class:"todoList_label"},ne=["checked","onClick"],le={key:0,class:"form-control"},ae=["value","onBlur","onKeyup"],ie=["onClick"],ce={key:0},re={key:1,class:"todoList_item"},ue={class:"todoList_label"},de=["checked","onClick"],ve={key:0,class:"form-control"},he=["value","onBlur","onKeyup"],pe=["onClick"],_e={key:2,class:"todoList_item"},fe={class:"todoList_label"},ke=["checked","onClick"],me={class:"form-control"},ge=["onClick"],ye={class:"todoList_statistics"},f="https://todolist-api.hexschool.io",Te={__name:"TodoListView",setup($e){const z=W(),r=k(""),p=k("");q("isLoading",p);const c=k([]),D=x(()=>c.value.length>0),L=k(null),C=k(""),v=k("all"),K=x(()=>c.value.filter(t=>t.status===!1).length),O=x(()=>c.value.filter(t=>t.status===!0)),V=x(()=>c.value.filter(t=>t.status===!1)),N=async()=>{console.log("logout"),p.value=!0;try{let t=document.cookie.split(";").find(n=>n.trim().startsWith("token="));t=t.split("=")[1],console.log("token exists:",t);const o=await _.post(f+"/users/sign_out",{},{headers:{Authorization:`${t}`}});console.log("res.data:",o.data),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",p.value=!1,r.value="",L.value=null,g.fire({title:"成功登出",icon:"success",confirmButtonText:"確定"})}catch(t){console.log("登出失敗",t),g.fire({title:"登出失敗",text:`${t.data.message}！`,icon:"error",confirmButtonText:"確定"}),p.value=!1}};(async()=>{console.log("checkOnline"),p.value=!0;try{const t=document.cookie.split(";");console.log("cookies:",t),r.value=t.find(n=>n.trim().startsWith("token=")).split("=")[1],r.value&&console.log("token exists:",r.value);const o=await _.get(f+"/users/checkout",{headers:{Authorization:`${r.value}`}});console.log(o.data),L.value=o.data,S()}catch{g.fire({title:"不再線上 即將踢人",icon:"error",confirmButtonText:"確定"}).then(o=>{z.push("/login"),p.value=!1})}})();const S=async()=>{console.log("token:",r.value);const t=await _.get(f+"/todos/",{headers:{Authorization:`${r.value}`}});console.log(t.data),t.data.data.forEach((o,n)=>{setTimeout(()=>{console.log("todo:",o),c.value.push(o),n===t.data.data.length-1&&(p.value=!1)},200*n)})},w=async(t,o)=>{console.log("id:",t);const n=`${f}/todos/${t}/toggle`;console.log(n);try{const u=await _.patch(n,{},{headers:{Authorization:`${r.value}`}}),e=c.value.find(l=>l.id===t);e.status=!e.status,console.log(u.data)}catch{}console.log(c.value)},E=async(t,o)=>{console.log("updateText","id:",t);const n=o.target.value,u=`${f}/todos/${t}`;console.log(u);try{const e=await _.put(u,{content:n},{headers:{Authorization:`${r.value}`}});e.status&&c.value.map(l=>(l.id===t&&(l.content=n,l.isEdit=!1),l)),o.target.value=n,console.log(e.data)}catch{}console.log(c.value)},A=async()=>{const t=`${f}/todos/`;console.log(t);const o=await _.post(t,{content:C.value},{headers:{Authorization:`${r.value}`}});console.log(o),o.status&&c.value.push(o.data.newTodo)},U=async t=>{console.log("id:",t);const o=c.value.find(n=>n.id===t);return g.fire({title:"確定要刪除這筆資料嗎？",text:`${o.content} 會被刪除`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(n=>{if(n.isConfirmed)return g.fire("刪除了！","資料已經被刪除。","success"),!0;if(n.isDismissed)return g.fire("取消刪除","資料未被刪除","info"),!1})},P=async(t,o)=>{if(!await U(t))return;console.log("id:",t);const n=`${f}/todos/${t}`;console.log(n);try{const u=await _.delete(n,{headers:{Authorization:`${r.value}`}});c.value=c.value.filter(e=>{if(e.id!=t)return e}),console.log(u.data)}catch{}console.log(c.value)};return(t,o)=>{var u;const n=F("font-awesome-icon");return a(),i("div",H,[m(j),s("nav",null,[o[4]||(o[4]=s("h1",null,[s("a",{href:"#"},"ONLINE TODO LIST")],-1)),s("ul",null,[s("li",J,[s("a",R,[s("span",null,y((u=L.value)==null?void 0:u.nickname)+"的代辦",1)])]),s("li",null,[s("a",{onClick:N,href:"#loginPage"},"登出")])])]),s("div",G,[s("div",Q,[s("div",X,[I(s("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>C.value=e),onKeypress:$(A,["enter"]),placeholder:"請輸入待辦事項"},null,544),[[M,C.value]]),C.value.trim()!==""?(a(),i("a",{key:0,href:"#",onClick:d(A,["prevent"])},[m(n,{icon:"plus"})])):(a(),i("a",Y,[m(n,{icon:"ban"})]))]),s("div",Z,[s("ul",ee,[s("li",null,[s("a",{href:"#",onClick:o[1]||(o[1]=d(e=>v.value="all",["prevent"])),class:T({active:v.value==="all"})},"全部",2)]),s("li",null,[s("a",{href:"#",onClick:o[2]||(o[2]=d(e=>v.value="uncompleted",["prevent"])),class:T({active:v.value==="uncompleted"})},"待完成",2)]),s("li",null,[s("a",{href:"#",onClick:o[3]||(o[3]=d(e=>v.value="completed",["prevent"])),class:T({active:v.value==="completed"})},"已完成",2)])]),s("div",te,[v.value==="all"?(a(),i("ul",se,[(a(!0),i(b,null,B(c.value,e=>(a(),i("li",{key:e.id},[s("label",oe,[s("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:d(l=>w(e.id),["prevent"])},null,8,ne),e.isEdit?h("",!0):(a(),i("span",le,y(e.content),1)),e.isEdit?(a(),i("input",{key:1,class:"form-control",type:"text",value:e.content,onBlur:l=>e.isEdit=!1,onKeyup:[$(l=>E(e.id,l),["enter"]),$(l=>e.isEdit=!1,["esc"])]},null,40,ae)):h("",!0)]),s("a",{href:"#",onClick:d(l=>e.isEdit=!0,["prevent"])},[m(n,{icon:"pen-to-square"})],8,ie)]))),128)),D.value?h("",!0):(a(),i("li",ce,"目前無代辦事項 "))])):h("",!0),v.value==="uncompleted"?(a(),i("ul",re,[(a(!0),i(b,null,B(V.value,e=>(a(),i("li",{key:e.id},[s("label",ue,[s("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:d(l=>w(e.id),["prevent"])},null,8,de),e.isEdit?h("",!0):(a(),i("span",ve,y(e.content),1)),e.isEdit?(a(),i("input",{key:1,class:"form-control",type:"text",value:e.content,onBlur:l=>e.isEdit=!1,onKeyup:[$(l=>E(e.id,l),["enter"]),$(l=>e.isEdit=!1,["esc"])]},null,40,he)):h("",!0)]),s("a",{href:"#",onClick:d(l=>e.isEdit=!0,["prevent"])},[m(n,{icon:"pen-to-square"})],8,pe)]))),128))])):h("",!0),v.value==="completed"?(a(),i("ul",_e,[(a(!0),i(b,null,B(O.value,e=>(a(),i("li",{key:e.id},[s("label",fe,[s("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:d(l=>w(e.id),["prevent"])},null,8,ke),s("span",me,y(e.content),1)]),s("a",{href:"#",onClick:d(l=>P(e.id),["prevent"])},[m(n,{icon:"times"})],8,ge)]))),128))])):h("",!0),s("div",ye,[s("p",null,y(K.value)+" 個未完成項目",1)])])])])])])}}};export{Te as default};
