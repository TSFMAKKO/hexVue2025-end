import{d as W,r as f,k as C,e as q,o as i,c,a as s,t as g,h as F,v as I,l as y,g as d,f as $,n as T,F as B,m as E,b as h}from"./index-71e43f9f.js";import{a as p}from"./axios-b5ee139b.js";import{S as k}from"./sweetalert2.esm.all-263d9c0b.js";const M={id:"todoListPage",class:"bg-half"},H={class:"todo_sm"},J={href:"#"},R={class:"conatiner todoListPage vhContainer"},j={class:"todoList_Content"},G={class:"inputBox"},Q={class:"todoList_list"},X={class:"todoList_tab"},Y={class:"todoList_items"},Z={key:0,class:"todoList_item"},ee={class:"todoList_label"},te=["checked","onClick"],se={key:0,class:"form-control"},oe=["value","onBlur","onKeyup"],ne=["onClick"],le={key:0},ae={key:1,class:"todoList_item"},ie={class:"todoList_label"},ce=["checked","onClick"],re={key:0,class:"form-control"},ue=["value","onBlur","onKeyup"],de=["onClick"],ve={key:2,class:"todoList_item"},he={class:"todoList_label"},pe=["checked","onClick"],_e={class:"form-control"},fe=["onClick"],ke={class:"todoList_statistics"},_="https://todolist-api.hexschool.io",xe={__name:"TodoListView",setup(me){const z=W(),r=f(""),m=f(""),a=f([]),D=C(()=>a.value.length>0),x=f(null),L=f(""),v=f("all"),K=C(()=>a.value.filter(e=>e.status===!1).length),O=C(()=>a.value.filter(e=>e.status===!0)),V=C(()=>a.value.filter(e=>e.status===!1)),N=async()=>{console.log("logout"),m.value=!0;try{let e=document.cookie.split(";").find(n=>n.trim().startsWith("token="));e=e.split("=")[1],console.log("token exists:",e);const o=await p.post(_+"/users/sign_out",{},{headers:{Authorization:`${e}`}});console.log("res.data:",o.data),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",r.value="",x.value=null,k.fire({title:"成功登出",icon:"success",confirmButtonText:"確定"})}catch(e){console.log("登出失敗",e),k.fire({title:"登出失敗",text:`${e.data.message}！`,icon:"error",confirmButtonText:"確定"})}m.value=!1};(async()=>{console.log("checkOnline"),m.value=!0;try{const e=document.cookie.split(";");console.log("cookies:",e),r.value=e.find(n=>n.trim().startsWith("token=")).split("=")[1],r.value&&console.log("token exists:",r.value);const o=await p.get(_+"/users/checkout",{headers:{Authorization:`${r.value}`}});console.log(o.data),x.value=o.data,S(),m.value=!1}catch{k.fire({title:"不再線上 即將踢人",icon:"error",confirmButtonText:"確定"}).then(o=>{z.push("/login"),m.value=!1})}})();const S=async()=>{console.log("token:",r.value);const e=await p.get(_+"/todos/",{headers:{Authorization:`${r.value}`}});console.log(e.data),e.data.data.forEach((o,n)=>{setTimeout(()=>{console.log("todo:",o),a.value.push(o)},200*n)})},w=async(e,o)=>{console.log("id:",e);const n=`${_}/todos/${e}/toggle`;console.log(n);try{const u=await p.patch(n,{},{headers:{Authorization:`${r.value}`}});let t=null;a.value.map(l=>(l.id===e&&(l.status=!l.status,t=l.status),l)),console.log(u.data)}catch{}console.log(a.value)},b=async(e,o)=>{console.log("updateText","id:",e);const n=o.target.value,u=`${_}/todos/${e}`;console.log(u);try{const t=await p.put(u,{content:n},{headers:{Authorization:`${r.value}`}});t.status&&a.value.map(l=>(l.id===e&&(l.content=n,l.isEdit=!1),l)),o.target.value=n,console.log(t.data)}catch{}console.log(a.value)},A=async()=>{const e=`${_}/todos/`;console.log(e);const o=await p.post(e,{content:L.value},{headers:{Authorization:`${r.value}`}});console.log(o),o.status&&a.value.push(o.data.newTodo)},U=async e=>{console.log("id:",e);const o=a.value.find(n=>n.id===e);return k.fire({title:"確定要刪除這筆資料嗎？",text:`${o.content} 會被刪除`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(n=>{if(n.isConfirmed)return k.fire("刪除了！","資料已經被刪除。","success"),!0;if(n.isDismissed)return k.fire("取消刪除","資料未被刪除","info"),!1})},P=async(e,o)=>{if(!await U(e))return;console.log("id:",e);const n=`${_}/todos/${e}`;console.log(n);try{const u=await p.delete(n,{headers:{Authorization:`${r.value}`}});a.value=a.value.filter(t=>{if(t.id!=e)return t}),console.log(u.data)}catch{}console.log(a.value)};return(e,o)=>{var u;const n=q("font-awesome-icon");return i(),c("div",M,[s("nav",null,[o[4]||(o[4]=s("h1",null,[s("a",{href:"#"},"ONLINE TODO LIST")],-1)),s("ul",null,[s("li",H,[s("a",J,[s("span",null,g((u=x.value)==null?void 0:u.nickname)+"的代辦",1)])]),s("li",null,[s("a",{onClick:N,href:"#loginPage"},"登出")])])]),s("div",R,[s("div",j,[s("div",G,[F(s("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=t=>L.value=t),onKeypress:y(A,["enter"]),placeholder:"請輸入待辦事項"},null,544),[[I,L.value]]),s("a",{href:"#",onClick:d(A,["prevent"])},[$(n,{icon:"plus"})])]),s("div",Q,[s("ul",X,[s("li",null,[s("a",{href:"#",onClick:o[1]||(o[1]=d(t=>v.value="all",["prevent"])),class:T({active:v.value==="all"})},"全部",2)]),s("li",null,[s("a",{href:"#",onClick:o[2]||(o[2]=d(t=>v.value="uncompleted",["prevent"])),class:T({active:v.value==="uncompleted"})},"待完成",2)]),s("li",null,[s("a",{href:"#",onClick:o[3]||(o[3]=d(t=>v.value="completed",["prevent"])),class:T({active:v.value==="completed"})},"已完成",2)])]),s("div",Y,[v.value==="all"?(i(),c("ul",Z,[(i(!0),c(B,null,E(a.value,t=>(i(),c("li",null,[s("label",ee,[s("input",{class:"todoList_input",type:"checkbox",checked:t.status,onClick:d(l=>w(t.id),["prevent"])},null,8,te),t.isEdit?h("",!0):(i(),c("span",se,g(t.content),1)),t.isEdit?(i(),c("input",{key:1,class:"form-control",type:"text",value:t.content,onBlur:l=>t.isEdit=!1,onKeyup:[y(l=>b(t.id,l),["enter"]),y(l=>t.isEdit=!1,["esc"])]},null,40,oe)):h("",!0)]),s("a",{href:"#",onClick:d(l=>t.isEdit=!0,["prevent"])},[$(n,{icon:"pen-to-square"})],8,ne)]))),256)),D.value?h("",!0):(i(),c("li",le,"目前無代辦事項 "))])):h("",!0),v.value==="uncompleted"?(i(),c("ul",ae,[(i(!0),c(B,null,E(V.value,t=>(i(),c("li",null,[s("label",ie,[s("input",{class:"todoList_input",type:"checkbox",checked:t.status,onClick:d(l=>w(t.id),["prevent"])},null,8,ce),t.isEdit?h("",!0):(i(),c("span",re,g(t.content),1)),t.isEdit?(i(),c("input",{key:1,class:"form-control",type:"text",value:t.content,onBlur:l=>t.isEdit=!1,onKeyup:[y(l=>b(t.id,l),["enter"]),y(l=>t.isEdit=!1,["esc"])]},null,40,ue)):h("",!0)]),s("a",{href:"#",onClick:d(l=>t.isEdit=!0,["prevent"])},[$(n,{icon:"pen-to-square"})],8,de)]))),256))])):h("",!0),v.value==="completed"?(i(),c("ul",ve,[(i(!0),c(B,null,E(O.value,t=>(i(),c("li",null,[s("label",he,[s("input",{class:"todoList_input",type:"checkbox",checked:t.status,onClick:d(l=>w(t.id),["prevent"])},null,8,pe),s("span",_e,g(t.content),1)]),s("a",{href:"#",onClick:d(l=>P(t.id),["prevent"])},[$(n,{icon:"times"})],8,fe)]))),256))])):h("",!0),s("div",ke,[s("p",null,g(K.value)+" 個未完成項目",1)])])])])])])}}};export{xe as default};
