import{i as B,a as O,o as d,c as v,f as I,v as P,j as y,b as t,k as j,l as z,e as _,d as h,F as q,m as R,g as A,t as b,n as D,u as J,r as L,p as H,q as E,s as G}from"./index-4ebec0e6.js";import{_ as Q,a as T}from"./isLoading-701f9197.js";import{S as V}from"./sweetalert2.esm.all-263d9c0b.js";const X={class:"inputBox"},Y={key:1,href:"#"},Z={__name:"TodoForm",emits:{createData:Function},setup($,{emit:x}){const a=x,s=B("createText"),n=()=>{s.value.trim()!==""&&(a("createData"),s.value="")};return(k,m)=>{const l=O("font-awesome-icon");return d(),v("div",X,[I(t("input",{type:"text","onUpdate:modelValue":m[0]||(m[0]=c=>j(s)?s.value=c:null),onKeypress:z(n,["enter"]),placeholder:"請輸入待辦事項"},null,544),[[P,y(s)]]),y(s).trim()!==""?(d(),v("a",{key:0,href:"#",onClick:_(n,["prevent"])},[h(l,{icon:"plus"})])):(d(),v("a",Y,[h(l,{icon:"ban"})]))])}}},ee={class:"todoList_item"},te={class:"todoList_label"},oe=["checked","onClick"],se={key:0,class:"form-control"},ne=["value","onBlur","onKeyup"],le=["onClick"],ae=["onClick"],ie={key:0},F={__name:"TodoItem",props:["todos","todosView"],emits:["toggle","updateText","deleteHandler"],setup($,{emit:x}){B("isLoading");const a=B("status"),s=x,n=(l,c)=>{s("toggle",l,c)},k=(l,c)=>{console.log("孫層id:",l,"value:",c.target.value),s("updateText",l,c.target.value),s("updateText",l,c)},m=(l,c)=>{s("deleteHandler",l,c)};return(l,c)=>{const u=O("font-awesome-icon");return d(),v("ul",ee,[(d(!0),v(q,null,R($.todosView,r=>(d(),v("li",{key:r.id},[t("label",te,[t("input",{class:"todoList_input",type:"checkbox",checked:r.status,onClick:_(f=>n(r.id,f),["prevent"])},null,8,oe),r.isEdit?A("",!0):(d(),v("span",se,b(r.content),1)),r.isEdit?(d(),v("input",{key:1,class:"form-control",type:"text",value:r.content,onBlur:f=>r.isEdit=!1,onKeyup:[z(f=>k(r.id,f),["enter"]),z(f=>r.isEdit=!1,["esc"])]},null,40,ne)):A("",!0)]),y(a)==="completed"?(d(),v("a",{key:0,href:"#",onClick:_(f=>m(r.id,f),["prevent"])},[h(u,{icon:"times"})],8,le)):(d(),v("a",{key:1,href:"#",onClick:_(f=>r.isEdit=!0,["prevent"])},[h(u,{icon:"pen-to-square"})],8,ae))]))),128)),$.todos.length===0?(d(),v("li",ie,"目前無代辦事項 ")):A("",!0)])}}},ce={class:"todoList_list"},re={class:"todoList_tab"},ue={class:"todoList_items"},de={class:"todoList_statistics"},ve={__name:"TodoList",props:["todos","todosView"],emits:["toggle","updateText","deleteHandler"],setup($,{emit:x}){const a=B("status");console.log("status:",a);const s=B("unCompletedWork");console.log("unCompletedWork:",s);const n=x,k=c=>{n("toggle",c)},m=(c,u)=>{n("updateText",c,u)},l=c=>{n("deleteHandler",c)};return(c,u)=>(d(),v("div",ce,[t("ul",re,[t("li",null,[t("a",{href:"#",onClick:u[0]||(u[0]=_(r=>a.value="all",["prevent"])),class:D({active:y(a)==="all"})},"全部",2)]),t("li",null,[t("a",{href:"#",onClick:u[1]||(u[1]=_(r=>a.value="uncompleted",["prevent"])),class:D({active:y(a)==="uncompleted"})},"待完成",2)]),t("li",null,[t("a",{href:"#",onClick:u[2]||(u[2]=_(r=>a.value="completed",["prevent"])),class:D({active:y(a)==="completed"})},"已完成",2)])]),t("div",ue,[h(F,{todos:$.todos,todosView:$.todosView,onToggle:k,onUpdateText:m,onDeleteHandler:l},null,8,["todos","todosView"]),t("div",de,[t("p",null,b(y(s))+" 個未完成項目",1)])])]))}};const pe={id:"todoListPage",class:"bg-half"},fe={class:"todo_sm"},_e={href:"#"},me={class:"conatiner todoListPage vhContainer"},ge={class:"todoList_Content"},he={class:"todoList_list"},ke={class:"todoList_tab"},$e={class:"todoList_items"},xe={class:"todoList_statistics"},w="https://todolist-api.hexschool.io",Ce={__name:"TodoListView",setup($){const x=J(),a=L(""),s=L("");H("isLoading",s);const n=L([]);E(()=>n.value.length>0);const k=L(null),m=L(""),l=L("all"),c=E(()=>n.value.filter(e=>e.status===!1).length),u=E(()=>{if(l.value==="all")return n.value;if(l.value==="uncompleted")return n.value.filter(e=>e.status===!1);if(l.value==="completed")return n.value.filter(e=>e.status===!0)}),r=async()=>{console.log("logout"),s.value=!0;try{let e=document.cookie.split(";").find(i=>i.trim().startsWith("token="));e=e.split("=")[1],console.log("token exists:",e);const o=await T.post(w+"/users/sign_out",{},{headers:{Authorization:`${e}`}});console.log("res.data:",o.data),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",s.value=!1,a.value="",k.value=null,V.fire({title:"成功登出",icon:"success",confirmButtonText:"確定"})}catch(e){console.log("登出失敗",e),V.fire({title:"登出失敗",text:`${e.data.message}！`,icon:"error",confirmButtonText:"確定"}),s.value=!1}},f=async()=>{console.log("checkOnline"),s.value=!0;try{const e=document.cookie.split(";");console.log("cookies:",e),a.value=e.find(i=>i.trim().startsWith("token=")).split("=")[1],a.value&&console.log("token exists:",a.value);const o=await T.get(w+"/users/checkout",{headers:{Authorization:`${a.value}`}});console.log(o.data),k.value=o.data,K()}catch{s.value=!1,V.fire({title:"不再線上 即將踢人",icon:"error",confirmButtonText:"確定"}).then(o=>{x.push("/login")})}};G(()=>{console.log("TodoListView onMounted"),s.value=!1,f()});const K=async()=>{console.log("token:",a.value),s.value=!0;const e=await T.get(w+"/todos/",{headers:{Authorization:`${a.value}`}});console.log(e.data),e.data.data.forEach((o,i)=>{setTimeout(()=>{console.log("todo:",o),n.value.push(o),i===e.data.data.length-1&&(s.value=!1)},400*(i+1))}),e.data.data.length===0&&(s.value=!1)},W=async(e,o)=>{console.log("id:",e);const i=`${w}/todos/${e}/toggle`;console.log(i);try{const p=await T.patch(i,{},{headers:{Authorization:`${a.value}`}}),g=n.value.find(C=>C.id===e);g.status=!g.status,console.log(p.data)}catch{}},U=async(e,o)=>{console.log("updateText","id:",e);const i=o.target.value,p=`${w}/todos/${e}`;console.log(p),s.value=!0;try{const g=await T.put(p,{content:i},{headers:{Authorization:`${a.value}`}});g.status&&n.value.map(C=>(C.id===e&&(C.content=i,C.isEdit=!1),C)),console.log(g.data)}catch{}s.value=!1,console.log(n.value)},M=async()=>{const e=`${w}/todos/`;console.log(e);const o=await T.post(e,{content:m.value},{headers:{Authorization:`${a.value}`}});console.log(o),o.status&&n.value.push(o.data.newTodo)},S=async e=>{console.log("id:",e);const o=n.value.find(i=>i.id===e);return V.fire({title:"確定要刪除這筆資料嗎？",text:`${o.content} 會被刪除`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(i=>{if(i.isConfirmed)return V.fire("刪除了！","資料已經被刪除。","success"),!0;if(i.isDismissed)return V.fire("取消刪除","資料未被刪除","info"),!1})},N=async(e,o)=>{if(!await S(e))return;console.log("id:",e);const i=`${w}/todos/${e}`;console.log(i);try{const p=await T.delete(i,{headers:{Authorization:`${a.value}`}});n.value=n.value.filter(g=>{if(g.id!=e)return g}),console.log(p.data)}catch{}};return H("createText",m),H("status",l),H("unCompletedWork",c),(e,o)=>{var i;return d(),v("div",pe,[h(Q),t("nav",null,[o[3]||(o[3]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",fe,[t("a",_e,[t("span",null,b((i=k.value)==null?void 0:i.nickname)+"的代辦",1)])]),t("li",null,[t("a",{onClick:r,href:"#loginPage"},"登出")])])]),t("div",me,[t("div",ge,[h(Z,{onCreateData:M}),t("div",he,[t("ul",ke,[t("li",null,[t("a",{href:"#",onClick:o[0]||(o[0]=_(p=>l.value="all",["prevent"])),class:D({active:l.value==="all"})},"全部",2)]),t("li",null,[t("a",{href:"#",onClick:o[1]||(o[1]=_(p=>l.value="uncompleted",["prevent"])),class:D({active:l.value==="uncompleted"})},"待完成",2)]),t("li",null,[t("a",{href:"#",onClick:o[2]||(o[2]=_(p=>l.value="completed",["prevent"])),class:D({active:l.value==="completed"})},"已完成",2)])]),t("div",$e,[h(F,{todosView:u.value,todos:n.value,onToggle:W,onUpdateText:U,onDeleteHandler:N},null,8,["todosView","todos"]),t("div",xe,[t("p",null,b(c.value)+" 個未完成項目",1)])])]),o[4]||(o[4]=t("hr",null,null,-1)),h(ve,{todosView:u.value,todos:n.value,onToggle:W,onUpdateText:U,onDeleteHandler:N},null,8,["todosView","todos"])])])])}}};export{Ce as default};
