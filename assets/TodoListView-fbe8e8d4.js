import{u as P,r as k,i as y,a as W,o as a,c as i,b as s,t as f,f as q,v as F,j as m,e as d,d as $,n as w,F as E,k as b,g as p}from"./index-fb55310f.js";import{a as h}from"./axios-b5ee139b.js";const I={id:"todoListPage",class:"bg-half"},M={class:"todo_sm"},S={href:"#"},j={class:"conatiner todoListPage vhContainer"},H={class:"todoList_Content"},J={class:"inputBox"},R={class:"todoList_list"},G={class:"todoList_tab"},Q={class:"todoList_items"},X={key:0,class:"todoList_item"},Y={class:"todoList_label"},Z=["checked","onClick"],ee={key:0,class:"form-control"},te=["value","onBlur","onKeyup"],se=["onClick"],oe={key:0},le={key:1,class:"todoList_item"},ne={class:"todoList_label"},ae=["checked","onClick"],ie={key:0,class:"form-control"},ce=["value","onBlur","onKeyup"],ue=["onClick"],re={key:2,class:"todoList_item"},de={class:"todoList_label"},ve=["checked","onClick"],pe={class:"form-control"},he=["onClick"],_e={class:"todoList_statistics"},_="https://todolist-api.hexschool.io",ye={__name:"TodoListView",setup(ke){const z=P(),u=k(""),g=k(""),c=k([]),B=y(()=>c.value.length>0),C=k(null),L=k(""),v=k("all"),D=y(()=>c.value.filter(t=>t.status===!0).length),K=y(()=>c.value.filter(t=>t.status===!0)),O=y(()=>c.value.filter(t=>t.status===!1)),V=async()=>{console.log("logout"),g.value=!0;try{let t=document.cookie.split(";").find(n=>n.trim().startsWith("token="));t=t.split("=")[1],console.log("token exists:",t);const o=await h.post(_+"/users/sign_out",{},{headers:{Authorization:`${t}`}});console.log("res.data:",o.data),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",u.value="",C.value=null,alert(`成功登出 ${o.data.message}`)}catch(t){alert(`登出失敗${t.data}`),console.log("登出失敗",t)}g.value=!1};(async()=>{console.log("checkOnline"),g.value=!0;try{const t=document.cookie.split(";");console.log("cookies:",t),u.value=t.find(n=>n.trim().startsWith("token=")).split("=")[1],u.value&&console.log("token exists:",u.value);const o=await h.get(_+"/users/checkout",{headers:{Authorization:`${u.value}`}});console.log(o.data),C.value=o.data,N(),g.value=!1}catch{alert("不再線上 即將踢人"),z.push("/login"),g.value=!1}})();const N=async()=>{console.log("token:",u.value);const t=await h.get(_+"/todos/",{headers:{Authorization:`${u.value}`}});console.log(t.data),t.data.data.forEach((o,n)=>{setTimeout(()=>{console.log("todo:",o),c.value.push(o)},200*n)})},x=async(t,o)=>{console.log("id:",t);const n=`${_}/todos/${t}/toggle`;console.log(n);try{const r=await h.patch(n,{},{headers:{Authorization:`${u.value}`}});let e=null;c.value.map(l=>(l.id===t&&(l.status=!l.status,e=l.status),l)),console.log(r.data)}catch{}console.log(c.value)},T=async(t,o)=>{console.log("updateText","id:",t);const n=o.target.value,r=`${_}/todos/${t}`;console.log(r);try{const e=await h.put(r,{content:n},{headers:{Authorization:`${u.value}`}});e.status&&c.value.map(l=>(l.id===t&&(l.content=n,l.isEdit=!1),l)),o.target.value=n,console.log(e.data)}catch{}console.log(c.value)},A=async()=>{const t=`${_}/todos/`;console.log(t);const o=await h.post(t,{content:L.value},{headers:{Authorization:`${u.value}`}});console.log(o),o.status&&c.value.push(o.data.newTodo)},U=async(t,o)=>{if(!confirm("確認刪除"))return;console.log("id:",t);const n=`${_}/todos/${t}`;console.log(n);try{const r=await h.delete(n,{headers:{Authorization:`${u.value}`}});c.value=c.value.filter(e=>{if(e.id!=t)return e}),console.log(r.data)}catch{}console.log(c.value)};return(t,o)=>{var r;const n=W("font-awesome-icon");return a(),i("div",I,[s("nav",null,[o[4]||(o[4]=s("h1",null,[s("a",{href:"#"},"ONLINE TODO LIST")],-1)),s("ul",null,[s("li",M,[s("a",S,[s("span",null,f((r=C.value)==null?void 0:r.nickname)+"的代辦",1)])]),s("li",null,[s("a",{onClick:V,href:"#loginPage"},"登出")])])]),s("div",j,[s("div",H,[s("div",J,[q(s("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>L.value=e),onKeypress:m(A,["enter"]),placeholder:"請輸入待辦事項"},null,544),[[F,L.value]]),s("a",{href:"#",onClick:d(A,["prevent"])},[$(n,{icon:"plus"})])]),s("div",R,[s("ul",G,[s("li",null,[s("a",{href:"#",onClick:o[1]||(o[1]=d(e=>v.value="all",["prevent"])),class:w({active:v.value==="all"})},"全部",2)]),s("li",null,[s("a",{href:"#",onClick:o[2]||(o[2]=d(e=>v.value="uncompleted",["prevent"])),class:w({active:v.value==="uncompleted"})},"待完成",2)]),s("li",null,[s("a",{href:"#",onClick:o[3]||(o[3]=d(e=>v.value="completed",["prevent"])),class:w({active:v.value==="completed"})},"已完成",2)])]),s("div",Q,[v.value==="all"?(a(),i("ul",X,[(a(!0),i(E,null,b(c.value,e=>(a(),i("li",null,[s("label",Y,[s("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:d(l=>x(e.id),["prevent"])},null,8,Z),e.isEdit?p("",!0):(a(),i("span",ee,f(e.content),1)),e.isEdit?(a(),i("input",{key:1,class:"form-control",type:"text",value:e.content,onBlur:l=>e.isEdit=!1,onKeyup:[m(l=>T(e.id,l),["enter"]),m(l=>e.isEdit=!1,["esc"])]},null,40,te)):p("",!0)]),s("a",{href:"#",onClick:d(l=>e.isEdit=!0,["prevent"])},[$(n,{icon:"pen-to-square"})],8,se)]))),256)),B.value?p("",!0):(a(),i("li",oe,"目前無代辦事項 "))])):p("",!0),v.value==="uncompleted"?(a(),i("ul",le,[(a(!0),i(E,null,b(O.value,e=>(a(),i("li",null,[s("label",ne,[s("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:d(l=>x(e.id),["prevent"])},null,8,ae),e.isEdit?p("",!0):(a(),i("span",ie,f(e.content),1)),e.isEdit?(a(),i("input",{key:1,class:"form-control",type:"text",value:e.content,onBlur:l=>e.isEdit=!1,onKeyup:[m(l=>T(e.id,l),["enter"]),m(l=>e.isEdit=!1,["esc"])]},null,40,ce)):p("",!0)]),s("a",{href:"#",onClick:d(l=>e.isEdit=!0,["prevent"])},[$(n,{icon:"pen-to-square"})],8,ue)]))),256))])):p("",!0),v.value==="completed"?(a(),i("ul",re,[(a(!0),i(E,null,b(K.value,e=>(a(),i("li",null,[s("label",de,[s("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:d(l=>x(e.id),["prevent"])},null,8,ve),s("span",pe,f(e.content),1)]),s("a",{href:"#",onClick:d(l=>U(e.id),["prevent"])},[$(n,{icon:"times"})],8,he)]))),256))])):p("",!0),s("div",_e,[s("p",null,f(D.value)+" 個已完成項目",1)])])])])])])}}};export{ye as default};
