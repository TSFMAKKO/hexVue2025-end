import{i as B,a as N,o as p,c as f,f as P,v as j,j as y,b as t,k as q,l as z,e as _,d as h,F as R,m as J,g as E,t as A,n as D,u as G,r as L,p as H,q as b,s as Q}from"./index-1314d5cd.js";import{_ as X,a as $}from"./isLoading-6e2c2eeb.js";import{S as V}from"./sweetalert2.esm.all-263d9c0b.js";const Y={class:"inputBox"},Z={key:1,href:"#"},ee={__name:"TodoForm",emits:{createData:Function},setup(T,{emit:w}){const l=w,a=B("createText"),s=()=>{a.value.trim()!==""&&(l("createData"),a.value="")};return(k,m)=>{const i=N("font-awesome-icon");return p(),f("div",Y,[P(t("input",{type:"text","onUpdate:modelValue":m[0]||(m[0]=c=>q(a)?a.value=c:null),onKeypress:z(s,["enter"]),placeholder:"請輸入待辦事項"},null,544),[[j,y(a)]]),y(a).trim()!==""?(p(),f("a",{key:0,href:"#",onClick:_(s,["prevent"])},[h(i,{icon:"plus"})])):(p(),f("a",Z,[h(i,{icon:"ban"})]))])}}},te={class:"todoList_item"},oe={class:"todoList_label"},se=["checked","onClick"],ne={key:0,class:"form-control"},le=["value","onBlur","onKeyup"],ae=["onClick"],ie=["onClick"],ce={key:0},O={__name:"TodoItem",props:["todos","todosView"],emits:["toggle","updateText","deleteHandler"],setup(T,{emit:w}){B("isLoading");const l=B("status"),a=w,s=(i,c)=>{a("toggle",i,c)},k=(i,c)=>{console.log("孫層id:",i,"value:",c.target.value),a("updateText",i,c.target.value)},m=(i,c)=>{a("deleteHandler",i,c)};return(i,c)=>{const d=N("font-awesome-icon");return p(),f("ul",te,[(p(!0),f(R,null,J(T.todosView,r=>(p(),f("li",{key:r.id},[t("label",oe,[t("input",{class:"todoList_input",type:"checkbox",checked:r.status,onClick:_(g=>s(r.id,g),["prevent"])},null,8,se),r.isEdit?E("",!0):(p(),f("span",ne,A(r.content),1)),r.isEdit?(p(),f("input",{key:1,class:"form-control",type:"text",value:r.content,onBlur:g=>r.isEdit=!1,onKeyup:[z(g=>k(r.id,g),["enter"]),z(g=>r.isEdit=!1,["esc"])]},null,40,le)):E("",!0)]),y(l)==="completed"?(p(),f("a",{key:0,href:"#",onClick:_(g=>m(r.id,g),["prevent"])},[h(d,{icon:"times"})],8,ae)):(p(),f("a",{key:1,href:"#",onClick:_(g=>r.isEdit=!0,["prevent"])},[h(d,{icon:"pen-to-square"})],8,ie))]))),128)),T.todos.length===0?(p(),f("li",ce,"目前無代辦事項 ")):E("",!0)])}}},re={class:"todoList_list"},ue={class:"todoList_tab"},de={class:"todoList_items"},ve={class:"todoList_statistics"},pe={__name:"TodoList",props:["todos","todosView"],emits:["toggle","updateText","deleteHandler"],setup(T,{emit:w}){const l=B("status");console.log("status:",l);const a=B("unCompletedWork");console.log("unCompletedWork:",a);const s=w,k=c=>{s("toggle",c)},m=(c,d)=>{s("updateText",c,d)},i=c=>{s("deleteHandler",c)};return(c,d)=>(p(),f("div",re,[t("ul",ue,[t("li",null,[t("a",{href:"#",onClick:d[0]||(d[0]=_(r=>l.value="all",["prevent"])),class:D({active:y(l)==="all"})},"全部",2)]),t("li",null,[t("a",{href:"#",onClick:d[1]||(d[1]=_(r=>l.value="uncompleted",["prevent"])),class:D({active:y(l)==="uncompleted"})},"待完成",2)]),t("li",null,[t("a",{href:"#",onClick:d[2]||(d[2]=_(r=>l.value="completed",["prevent"])),class:D({active:y(l)==="completed"})},"已完成",2)])]),t("div",de,[h(O,{todos:T.todos,todosView:T.todosView,onToggle:k,onUpdateText:m,onDeleteHandler:i},null,8,["todos","todosView"]),t("div",ve,[t("p",null,A(y(a))+" 個未完成項目",1)])])]))}};const fe={id:"todoListPage",class:"bg-half"},ge={class:"todo_sm"},_e={href:"#"},me={class:"conatiner todoListPage vhContainer"},he={class:"todoList_Content"},ke={class:"todoList_list"},$e={class:"todoList_tab"},xe={class:"todoList_items"},Te={class:"todoList_statistics"},x="https://todolist-api.hexschool.io",Le={__name:"TodoListView",setup(T){const w=G(),l=L(""),a=L("");H("isLoading",a);const s=L([]);b(()=>s.value.length>0);const k=L(null),m=L(""),i=L("all"),c=b(()=>s.value.filter(e=>e.status===!1).length),d=b(()=>{if(i.value==="all")return s.value;if(i.value==="uncompleted")return s.value.filter(e=>e.status===!1);if(i.value==="completed")return s.value.filter(e=>e.status===!0)}),r=async()=>{console.log("logout"),a.value=!0;try{let e=document.cookie.split(";").find(n=>n.trim().startsWith("token="));e=e.split("=")[1],console.log("token exists:",e);const o=await $.post(x+"/users/sign_out",{},{headers:{Authorization:`${e}`}});console.log("res.data:",o.data),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",a.value=!1,l.value="",k.value=null,V.fire({title:"成功登出",icon:"success",confirmButtonText:"確定"})}catch(e){console.log("登出失敗",e),V.fire({title:"登出失敗",text:`${e.data.message}！`,icon:"error",confirmButtonText:"確定"}),a.value=!1}},g=async()=>{console.log("checkOnline"),a.value=!0;try{const e=document.cookie.split(";");console.log("cookies:",e),l.value=e.find(n=>n.trim().startsWith("token=")).split("=")[1],l.value&&console.log("token exists:",l.value);const o=await $.get(x+"/users/checkout",{headers:{Authorization:`${l.value}`}});console.log(o.data),k.value=o.data,F()}catch{V.fire({title:"不再線上 即將踢人",icon:"error",confirmButtonText:"確定"}).then(o=>{w.push("/login"),a.value=!1})}};Q(()=>{console.log("TodoListView onMounted"),a.value=!1,g()});const F=async()=>{console.log("token:",l.value),a.value=!0;const e=await $.get(x+"/todos/",{headers:{Authorization:`${l.value}`}});console.log(e.data),e.data.data.forEach((o,n)=>{setTimeout(()=>{console.log("todo:",o),s.value.push(o),n===e.data.data.length-1&&(a.value=!1)},400*(n+1))}),e.data.data.length===0&&(a.value=!1)},W=async(e,o)=>{console.log("id:",e);const n=`${x}/todos/${e}/toggle`;console.log(n);try{const u=await $.patch(n,{},{headers:{Authorization:`${l.value}`}}),v=s.value.find(C=>C.id===e);v.status=!v.status,console.log(u.data)}catch{}console.log(s.value)},K=async(e,o)=>{console.log("updateText","id:",e);const n=o.target.value,u=`${x}/todos/${e}`;console.log(u);try{const v=await $.put(u,{content:n},{headers:{Authorization:`${l.value}`}});v.status&&s.value.map(C=>(C.id===e&&(C.content=n,C.isEdit=!1),C)),console.log(v.data)}catch{}console.log(s.value)},M=async(e,o)=>{console.log("updateText","id:",e,"newContent:",o);const n=`${x}/todos/${e}`;console.log(n);try{const u=await $.put(n,{content:o},{headers:{Authorization:`${l.value}`}});u.status&&s.value.map(v=>(v.id===e&&(v.content=o,v.isEdit=!1),v)),console.log(u.data)}catch{}console.log(s.value)},S=async()=>{const e=`${x}/todos/`;console.log(e);const o=await $.post(e,{content:m.value},{headers:{Authorization:`${l.value}`}});console.log(o),o.status&&s.value.push(o.data.newTodo)},I=async e=>{console.log("id:",e);const o=s.value.find(n=>n.id===e);return V.fire({title:"確定要刪除這筆資料嗎？",text:`${o.content} 會被刪除`,icon:"warning",showCancelButton:!0,confirmButtonText:"確定",cancelButtonText:"取消"}).then(n=>{if(n.isConfirmed)return V.fire("刪除了！","資料已經被刪除。","success"),!0;if(n.isDismissed)return V.fire("取消刪除","資料未被刪除","info"),!1})},U=async(e,o)=>{if(!await I(e))return;console.log("id:",e);const n=`${x}/todos/${e}`;console.log(n);try{const u=await $.delete(n,{headers:{Authorization:`${l.value}`}});s.value=s.value.filter(v=>{if(v.id!=e)return v}),console.log(u.data)}catch{}console.log(s.value)};return H("createText",m),H("status",i),H("unCompletedWork",c),(e,o)=>{var n;return p(),f("div",fe,[h(X),t("nav",null,[o[3]||(o[3]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",ge,[t("a",_e,[t("span",null,A((n=k.value)==null?void 0:n.nickname)+"的代辦",1)])]),t("li",null,[t("a",{onClick:r,href:"#loginPage"},"登出")])])]),t("div",me,[t("div",he,[h(ee,{onCreateData:S}),t("div",ke,[t("ul",$e,[t("li",null,[t("a",{href:"#",onClick:o[0]||(o[0]=_(u=>i.value="all",["prevent"])),class:D({active:i.value==="all"})},"全部",2)]),t("li",null,[t("a",{href:"#",onClick:o[1]||(o[1]=_(u=>i.value="uncompleted",["prevent"])),class:D({active:i.value==="uncompleted"})},"待完成",2)]),t("li",null,[t("a",{href:"#",onClick:o[2]||(o[2]=_(u=>i.value="completed",["prevent"])),class:D({active:i.value==="completed"})},"已完成",2)])]),t("div",xe,[h(O,{todosView:d.value,todos:s.value,onToggle:W,onUpdateText:K,onDeleteHandler:U},null,8,["todosView","todos"]),t("div",Te,[t("p",null,A(c.value)+" 個未完成項目",1)])])]),o[4]||(o[4]=t("hr",null,null,-1)),h(pe,{todosView:d.value,todos:s.value,onToggle:W,onUpdateText:M,onDeleteHandler:U},null,8,["todosView","todos"])])])])}}};export{Le as default};
