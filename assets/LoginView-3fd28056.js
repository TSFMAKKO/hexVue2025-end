import{i as L,u as V,o as i,c as r,a as e,b as m,_ as S,d as $,r as n,p as B,e as T,f as c,w,g as D,h as y,v as x,t as g,F,j as N}from"./index-71e43f9f.js";import{a as U}from"./axios-b5ee139b.js";import{S as k}from"./sweetalert2.esm.all-263d9c0b.js";const j={key:0,id:"loading-overlay",class:"d-flex justify-content-center align-items-center"},E={__name:"isLoading",setup(b){const u=L("isLoading");return console.log("isLoading:",u.value),(l,a)=>V(u)?(i(),r("div",j,a[0]||(a[0]=[e("div",{class:"apple-spinner"},[e("div"),e("div"),e("div"),e("div"),e("div"),e("div"),e("div"),e("div"),e("div"),e("div"),e("div"),e("div")],-1)]))):m("",!0)}};const P={id:"loginPage",class:"bg-yellow"},I={class:"conatiner loginPage vhContainer"},M={class:"side"},A={key:0,class:"error-message"},R={key:1,class:"error-message"},q={key:2,class:"error-message"},z="https://todolist-api.hexschool.io",G={__name:"LoginView",setup(b){const u=$(),l=n("example333@gmail.com"),a=n("example"),t=n({email:"",password:"",login:""}),d=n(!1),p=n("");B("isLoading",d);const _=(o,s)=>o.value?(t.value[o.key]="",!0):(t.value[o.key]=s,!1),h=()=>{t.value={};const o=_({value:l.value,key:"email"},"請填寫 email"),s=_({value:a.value,key:"password"},"請填寫密碼");return o&&s},C=async()=>{if(h()){console.log("登入資訊:",{email:l.value,password:a.value}),console.log("login"),d.value=!0;try{const o=await U.post(z+"/users/sign_in",{email:l.value,password:a.value});console.log("res:",o.data),p.value=o.data.token,console.log(p.value),k.fire({title:"登入成功",text:`${o.data.nickname} 歡迎回來`,icon:"success",confirmButtonText:"確定"}).then(s=>{u.push("/todos")}),document.cookie=`token=${p.value}; expires=${new Date(Date.now()+3600*1e3).toUTCString()}; path=/`,d.value=!1}catch(o){alert(`登入失敗${o.response.data.message}`),k.fire({title:"登入失敗",text:"帳號或密碼錯誤",icon:"error",confirmButtonText:"重新輸入"}),console.error("登入失敗:",o),d.value=!1,o.response&&o.response.data?t.value.login=o.response.data.message||"登入失敗，請稍後再試":t.value.login="登入失敗，請稍後再試";return}}};return(o,s)=>{const f=T("router-link");return i(),r(F,null,[e("div",null,[e("div",P,[e("div",I,[e("div",M,[c(f,{to:"/"},{default:w(()=>s[2]||(s[2]=[e("img",{class:"logoImg",src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/logo.png",alt:"待辦事項"},null,-1)])),_:1,__:[2]}),s[3]||(s[3]=e("img",{class:"d-m-n",src:"https://raw.githubusercontent.com/hexschool/2022-web-layout-training/main/todolist/img.png",alt:"工作圖片"},null,-1))]),e("div",null,[e("form",{class:"formControls",onSubmit:D(C,["prevent"])},[s[5]||(s[5]=e("h2",{class:"formControls_txt"},"最實用的線上代辦事項服務",-1)),s[6]||(s[6]=e("label",{class:"formControls_label",for:"email"},"Email",-1)),y(e("input",{class:"formControls_input",type:"email",id:"email","onUpdate:modelValue":s[0]||(s[0]=v=>l.value=v),placeholder:"請輸入 email"},null,512),[[x,l.value]]),t.value.email?(i(),r("span",A,g(t.value.email),1)):m("",!0),s[7]||(s[7]=e("label",{class:"formControls_label",for:"pwd"},"密碼",-1)),y(e("input",{class:"formControls_input",type:"password",id:"pwd","onUpdate:modelValue":s[1]||(s[1]=v=>a.value=v),placeholder:"請輸入密碼"},null,512),[[x,a.value]]),t.value.password?(i(),r("span",R,g(t.value.password),1)):m("",!0),t.value.login?(i(),r("span",q,g(t.value.login),1)):m("",!0),s[8]||(s[8]=e("button",{type:"submit",class:"formControls_btnSubmit"},"登入",-1)),c(f,{to:"/signup",class:"formControls_btnLink"},{default:w(()=>s[4]||(s[4]=[N("註冊帳號",-1)])),_:1,__:[4]})],32)])])])]),c(E)],64)}}},O=S(G,[["__scopeId","data-v-49cff008"]]);export{O as default};
