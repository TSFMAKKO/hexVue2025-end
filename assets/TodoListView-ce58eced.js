import{u as N,r as k,i as L,o as n,c as a,b as t,t as g,f as U,v as P,j as m,e as r,n as x,F as w,k as E,g as p}from"./index-acad7c2e.js";import{a as h}from"./axios-b5ee139b.js";const W={id:"todoListPage",class:"bg-half"},F={class:"todo_sm"},I={href:"#"},M={class:"conatiner todoListPage vhContainer"},S={class:"todoList_Content"},j={class:"inputBox"},H={class:"todoList_list"},J={class:"todoList_tab"},R={class:"todoList_items"},q={key:0,class:"todoList_item"},G={class:"todoList_label"},Q=["checked","onClick"],X={key:0,class:"form-control"},Y=["value","onBlur","onKeyup"],Z=["onClick"],ee={key:1,class:"todoList_item"},te={class:"todoList_label"},se=["checked","onClick"],oe={key:0,class:"form-control"},le=["value","onBlur","onKeyup"],ne=["onClick"],ae={key:2,class:"todoList_item"},ie={class:"todoList_label"},ce=["checked","onClick"],ue={class:"form-control"},re=["onClick"],de={class:"todoList_statistics"},_="https://todolist-api.hexschool.io",ke={__name:"TodoListView",setup(ve){const A=N(),c=k(""),f=k(""),i=k([]),y=k(null),$=k(""),d=k("all"),z=L(()=>i.value.filter(s=>s.status===!0).length),B=L(()=>i.value.filter(s=>s.status===!0)),D=L(()=>i.value.filter(s=>s.status===!1)),K=async()=>{console.log("logout"),f.value=!0;try{let s=document.cookie.split(";").find(e=>e.trim().startsWith("token="));s=s.split("=")[1],console.log("token exists:",s);const o=await h.post(_+"/users/sign_out",{},{headers:{Authorization:`${s}`}});console.log("res.data:",o.data),document.cookie="token=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/",c.value="",y.value=null,alert(`成功登出 ${o.data.message}`)}catch(s){alert(`登出失敗${s.data}`),console.log("登出失敗",s)}f.value=!1};(async()=>{console.log("checkOnline"),f.value=!0;try{const s=document.cookie.split(";");console.log("cookies:",s),c.value=s.find(e=>e.trim().startsWith("token=")).split("=")[1],c.value&&console.log("token exists:",c.value);const o=await h.get(_+"/users/checkout",{headers:{Authorization:`${c.value}`}});console.log(o.data),y.value=o.data,O(),f.value=!1}catch{alert("不再線上 即將踢人"),A.push("/login"),f.value=!1}})();const O=async()=>{console.log("token:",c.value);const s=await h.get(_+"/todos/",{headers:{Authorization:`${c.value}`}});console.log(s.data),s.data.data.forEach((o,e)=>{setTimeout(()=>{console.log("todo:",o),i.value.push(o)},200*e)})},C=async(s,o)=>{console.log("id:",s);const e=`${_}/todos/${s}/toggle`;console.log(e);try{const l=await h.patch(e,{},{headers:{Authorization:`${c.value}`}});let v=null;i.value.map(u=>(u.id===s&&(u.status=!u.status,v=u.status),u)),console.log(l.data)}catch{}console.log(i.value)},b=async(s,o)=>{console.log("updateText","id:",s);const e=o.target.value,l=`${_}/todos/${s}`;console.log(l);try{const v=await h.put(l,{content:e},{headers:{Authorization:`${c.value}`}});v.status&&i.value.map(u=>(u.id===s&&(u.content=e,u.isEdit=!1),u)),o.target.value=e,console.log(v.data)}catch{}console.log(i.value)},T=async()=>{const s=`${_}/todos/`;console.log(s);const o=await h.post(s,{content:$.value},{headers:{Authorization:`${c.value}`}});console.log(o),o.status&&i.value.push(o.data.newTodo)},V=async(s,o)=>{if(!confirm("確認刪除"))return;console.log("id:",s);const e=`${_}/todos/${s}`;console.log(e);try{const l=await h.delete(e,{headers:{Authorization:`${c.value}`}});i.value=i.value.filter(v=>{if(v.id!=s)return v}),console.log(l.data)}catch{}console.log(i.value)};return(s,o)=>(n(),a("div",W,[t("nav",null,[o[4]||(o[4]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",F,[t("a",I,[t("span",null,g(y.value.nickname)+"的代辦",1)])]),t("li",null,[t("a",{onClick:K,href:"#loginPage"},"登出")])])]),t("div",M,[t("div",S,[t("div",j,[U(t("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=e=>$.value=e),onKeypress:m(T,["enter"]),placeholder:"請輸入待辦事項"},null,544),[[P,$.value]]),t("a",{href:"#",onClick:r(T,["prevent"])},o[5]||(o[5]=[t("i",{class:"fa fa-plus"},null,-1)]))]),t("div",H,[t("ul",J,[t("li",null,[t("a",{href:"#",onClick:o[1]||(o[1]=r(e=>d.value="all",["prevent"])),class:x({active:d.value==="all"})},"全部",2)]),t("li",null,[t("a",{href:"#",onClick:o[2]||(o[2]=r(e=>d.value="uncompleted",["prevent"])),class:x({active:d.value==="uncompleted"})},"待完成",2)]),t("li",null,[t("a",{href:"#",onClick:o[3]||(o[3]=r(e=>d.value="completed",["prevent"])),class:x({active:d.value==="completed"})},"已完成",2)])]),t("div",R,[d.value==="all"?(n(),a("ul",q,[(n(!0),a(w,null,E(i.value,e=>(n(),a("li",null,[t("label",G,[t("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:r(l=>C(e.id),["prevent"])},null,8,Q),e.isEdit?p("",!0):(n(),a("span",X,g(e.content),1)),e.isEdit?(n(),a("input",{key:1,class:"form-control",type:"text",value:e.content,onBlur:l=>e.isEdit=!1,onKeyup:[m(l=>b(e.id,l),["enter"]),m(l=>e.isEdit=!1,["esc"])]},null,40,Y)):p("",!0)]),t("a",{href:"#",onClick:r(l=>e.isEdit=!0,["prevent"])},o[6]||(o[6]=[t("i",{class:"fa fa-times"},"編輯",-1)]),8,Z)]))),256))])):p("",!0),d.value==="uncompleted"?(n(),a("ul",ee,[(n(!0),a(w,null,E(D.value,e=>(n(),a("li",null,[t("label",te,[t("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:r(l=>C(e.id),["prevent"])},null,8,se),e.isEdit?p("",!0):(n(),a("span",oe,g(e.content),1)),e.isEdit?(n(),a("input",{key:1,class:"form-control",type:"text",value:e.content,onBlur:l=>e.isEdit=!1,onKeyup:[m(l=>b(e.id,l),["enter"]),m(l=>e.isEdit=!1,["esc"])]},null,40,le)):p("",!0)]),t("a",{href:"#",onClick:r(l=>e.isEdit=!0,["prevent"])},o[7]||(o[7]=[t("i",{class:"fa fa-times"},"編輯",-1)]),8,ne)]))),256))])):p("",!0),d.value==="completed"?(n(),a("ul",ae,[(n(!0),a(w,null,E(B.value,e=>(n(),a("li",null,[t("label",ie,[t("input",{class:"todoList_input",type:"checkbox",checked:e.status,onClick:r(l=>C(e.id),["prevent"])},null,8,ce),t("span",ue,g(e.content),1)]),t("a",{href:"#",onClick:r(l=>V(e.id),["prevent"])},o[8]||(o[8]=[t("i",{class:"fa fa-times"},"刪除",-1)]),8,re)]))),256))])):p("",!0),t("div",de,[t("p",null,g(z.value)+" 個已完成項目",1)])])])])])]))}};export{ke as default};
